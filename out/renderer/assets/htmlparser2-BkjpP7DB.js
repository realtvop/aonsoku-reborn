import{x as t,h as e,d as i,B as s,r as n,f as a}from"./entities-C7W22rEe.js";import{D as r}from"./domhandler-BfnXUw5w.js";var h,o,c,l,u,d;function b(t){return t===h.Space||t===h.NewLine||t===h.Tab||t===h.FormFeed||t===h.CarriageReturn}function m(t){return t===h.Slash||t===h.Gt||b(t)}function f(t){return t>=h.Zero&&t<=h.Nine}(o=h||(h={}))[o.Tab=9]="Tab",o[o.NewLine=10]="NewLine",o[o.FormFeed=12]="FormFeed",o[o.CarriageReturn=13]="CarriageReturn",o[o.Space=32]="Space",o[o.ExclamationMark=33]="ExclamationMark",o[o.Number=35]="Number",o[o.Amp=38]="Amp",o[o.SingleQuote=39]="SingleQuote",o[o.DoubleQuote=34]="DoubleQuote",o[o.Dash=45]="Dash",o[o.Slash=47]="Slash",o[o.Zero=48]="Zero",o[o.Nine=57]="Nine",o[o.Semi=59]="Semi",o[o.Lt=60]="Lt",o[o.Eq=61]="Eq",o[o.Gt=62]="Gt",o[o.Questionmark=63]="Questionmark",o[o.UpperA=65]="UpperA",o[o.LowerA=97]="LowerA",o[o.UpperF=70]="UpperF",o[o.LowerF=102]="LowerF",o[o.UpperZ=90]="UpperZ",o[o.LowerZ=122]="LowerZ",o[o.LowerX=120]="LowerX",o[o.OpeningSquareBracket=91]="OpeningSquareBracket",(l=c||(c={}))[l.Text=1]="Text",l[l.BeforeTagName=2]="BeforeTagName",l[l.InTagName=3]="InTagName",l[l.InSelfClosingTag=4]="InSelfClosingTag",l[l.BeforeClosingTagName=5]="BeforeClosingTagName",l[l.InClosingTagName=6]="InClosingTagName",l[l.AfterClosingTagName=7]="AfterClosingTagName",l[l.BeforeAttributeName=8]="BeforeAttributeName",l[l.InAttributeName=9]="InAttributeName",l[l.AfterAttributeName=10]="AfterAttributeName",l[l.BeforeAttributeValue=11]="BeforeAttributeValue",l[l.InAttributeValueDq=12]="InAttributeValueDq",l[l.InAttributeValueSq=13]="InAttributeValueSq",l[l.InAttributeValueNq=14]="InAttributeValueNq",l[l.BeforeDeclaration=15]="BeforeDeclaration",l[l.InDeclaration=16]="InDeclaration",l[l.InProcessingInstruction=17]="InProcessingInstruction",l[l.BeforeComment=18]="BeforeComment",l[l.CDATASequence=19]="CDATASequence",l[l.InSpecialComment=20]="InSpecialComment",l[l.InCommentLike=21]="InCommentLike",l[l.BeforeSpecialS=22]="BeforeSpecialS",l[l.SpecialStartSequence=23]="SpecialStartSequence",l[l.InSpecialTag=24]="InSpecialTag",l[l.BeforeEntity=25]="BeforeEntity",l[l.BeforeNumericEntity=26]="BeforeNumericEntity",l[l.InNamedEntity=27]="InNamedEntity",l[l.InNumericEntity=28]="InNumericEntity",l[l.InHexEntity=29]="InHexEntity",(d=u||(u={}))[d.NoValue=0]="NoValue",d[d.Unquoted=1]="Unquoted",d[d.Single=2]="Single",d[d.Double=3]="Double";const g={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class S{constructor({xmlMode:i=!1,decodeEntities:s=!0},n){this.cbs=n,this.state=c.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=c.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=i,this.decodeEntities=s,this.entityTrie=i?t:e}reset(){this.state=c.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=c.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===h.Lt||!this.decodeEntities&&this.fastForwardTo(h.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=c.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===h.Amp&&(this.state=c.BeforeEntity)}stateSpecialStartSequence(t){const e=this.sequenceIndex===this.currentSequence.length;if(e?m(t):(32|t)===this.currentSequence[this.sequenceIndex]){if(!e)return void this.sequenceIndex++}else this.isSpecial=!1;this.sequenceIndex=0,this.state=c.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===h.Gt||b(t)){const e=this.index-this.currentSequence.length;if(this.sectionStart<e){const t=this.index;this.index=e,this.cbs.ontext(this.sectionStart,e),this.index=t}return this.isSpecial=!1,this.sectionStart=e+2,void this.stateInClosingTagName(t)}this.sequenceIndex=0}(32|t)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:0===this.sequenceIndex?this.currentSequence===g.TitleEnd?this.decodeEntities&&t===h.Amp&&(this.state=c.BeforeEntity):this.fastForwardTo(h.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(t===h.Lt)}stateCDATASequence(t){t===g.Cdata[this.sequenceIndex]?++this.sequenceIndex===g.Cdata.length&&(this.state=c.InCommentLike,this.currentSequence=g.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=c.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===g.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=c.Text):0===this.sequenceIndex?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!m(t):function(t){return t>=h.LowerA&&t<=h.LowerZ||t>=h.UpperA&&t<=h.UpperZ}(t)}startSpecial(t,e){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=e,this.state=c.SpecialStartSequence}stateBeforeTagName(t){if(t===h.ExclamationMark)this.state=c.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===h.Questionmark)this.state=c.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const e=32|t;this.sectionStart=this.index,this.xmlMode||e!==g.TitleEnd[2]?this.state=this.xmlMode||e!==g.ScriptEnd[2]?c.InTagName:c.BeforeSpecialS:this.startSpecial(g.TitleEnd,3)}else t===h.Slash?this.state=c.BeforeClosingTagName:(this.state=c.Text,this.stateText(t))}stateInTagName(t){m(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=c.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){b(t)||(t===h.Gt?this.state=c.Text:(this.state=this.isTagStartChar(t)?c.InClosingTagName:c.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===h.Gt||b(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=c.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.state=c.Text,this.baseState=c.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===h.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=c.InSpecialTag,this.sequenceIndex=0):this.state=c.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===h.Slash?this.state=c.InSelfClosingTag:b(t)||(this.state=c.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===h.Gt?(this.cbs.onselfclosingtag(this.index),this.state=c.Text,this.baseState=c.Text,this.sectionStart=this.index+1,this.isSpecial=!1):b(t)||(this.state=c.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===h.Eq||m(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=c.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===h.Eq?this.state=c.BeforeAttributeValue:t===h.Slash||t===h.Gt?(this.cbs.onattribend(u.NoValue,this.index),this.state=c.BeforeAttributeName,this.stateBeforeAttributeName(t)):b(t)||(this.cbs.onattribend(u.NoValue,this.index),this.state=c.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===h.DoubleQuote?(this.state=c.InAttributeValueDq,this.sectionStart=this.index+1):t===h.SingleQuote?(this.state=c.InAttributeValueSq,this.sectionStart=this.index+1):b(t)||(this.sectionStart=this.index,this.state=c.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,e){t===e||!this.decodeEntities&&this.fastForwardTo(e)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(e===h.DoubleQuote?u.Double:u.Single,this.index),this.state=c.BeforeAttributeName):this.decodeEntities&&t===h.Amp&&(this.baseState=this.state,this.state=c.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,h.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,h.SingleQuote)}stateInAttributeValueNoQuotes(t){b(t)||t===h.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(u.Unquoted,this.index),this.state=c.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===h.Amp&&(this.baseState=this.state,this.state=c.BeforeEntity)}stateBeforeDeclaration(t){t===h.OpeningSquareBracket?(this.state=c.CDATASequence,this.sequenceIndex=0):this.state=t===h.Dash?c.BeforeComment:c.InDeclaration}stateInDeclaration(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=c.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=c.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===h.Dash?(this.state=c.InCommentLike,this.currentSequence=g.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=c.InDeclaration}stateInSpecialComment(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=c.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const e=32|t;e===g.ScriptEnd[3]?this.startSpecial(g.ScriptEnd,4):e===g.StyleEnd[3]?this.startSpecial(g.StyleEnd,4):(this.state=c.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===h.Number?this.state=c.BeforeNumericEntity:t===h.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=c.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=i(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0)return this.emitNamedEntity(),void this.index--;this.trieCurrent=this.entityTrie[this.trieIndex];const e=this.trieCurrent&s.VALUE_LENGTH;if(e){const i=(e>>14)-1;if(this.allowLegacyEntity()||t===h.Semi){const t=this.index-this.entityExcess+1;t>this.sectionStart&&this.emitPartial(this.sectionStart,t),this.entityResult=this.trieIndex,this.trieIndex+=i,this.entityExcess=0,this.sectionStart=this.index+1,0===i&&this.emitNamedEntity()}else this.trieIndex+=i}}emitNamedEntity(){if(this.state=this.baseState,0===this.entityResult)return;switch((this.entityTrie[this.entityResult]&s.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~s.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(32|t)===h.LowerX?(this.entityExcess++,this.state=c.InHexEntity):(this.state=c.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const e=this.index-this.entityExcess-1;e+2+Number(this.state===c.InHexEntity)!==this.index&&(e>this.sectionStart&&this.emitPartial(this.sectionStart,e),this.sectionStart=this.index+Number(t),this.emitCodePoint(n(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===h.Semi?this.emitNumericEntity(!0):f(t)?(this.entityResult=10*this.entityResult+(t-h.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===h.Semi?this.emitNumericEntity(!0):f(t)?(this.entityResult=16*this.entityResult+(t-h.Zero),this.entityExcess++):!function(t){return t>=h.UpperA&&t<=h.UpperF||t>=h.LowerA&&t<=h.LowerF}(t)?(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--):(this.entityResult=16*this.entityResult+((32|t)-h.LowerA+10),this.entityExcess++)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===c.Text||this.baseState===c.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===c.Text||this.state===c.InSpecialTag&&0===this.sequenceIndex?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):this.state!==c.InAttributeValueDq&&this.state!==c.InAttributeValueSq&&this.state!==c.InAttributeValueNq||(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case c.Text:this.stateText(t);break;case c.SpecialStartSequence:this.stateSpecialStartSequence(t);break;case c.InSpecialTag:this.stateInSpecialTag(t);break;case c.CDATASequence:this.stateCDATASequence(t);break;case c.InAttributeValueDq:this.stateInAttributeValueDoubleQuotes(t);break;case c.InAttributeName:this.stateInAttributeName(t);break;case c.InCommentLike:this.stateInCommentLike(t);break;case c.InSpecialComment:this.stateInSpecialComment(t);break;case c.BeforeAttributeName:this.stateBeforeAttributeName(t);break;case c.InTagName:this.stateInTagName(t);break;case c.InClosingTagName:this.stateInClosingTagName(t);break;case c.BeforeTagName:this.stateBeforeTagName(t);break;case c.AfterAttributeName:this.stateAfterAttributeName(t);break;case c.InAttributeValueSq:this.stateInAttributeValueSingleQuotes(t);break;case c.BeforeAttributeValue:this.stateBeforeAttributeValue(t);break;case c.BeforeClosingTagName:this.stateBeforeClosingTagName(t);break;case c.AfterClosingTagName:this.stateAfterClosingTagName(t);break;case c.BeforeSpecialS:this.stateBeforeSpecialS(t);break;case c.InAttributeValueNq:this.stateInAttributeValueNoQuotes(t);break;case c.InSelfClosingTag:this.stateInSelfClosingTag(t);break;case c.InDeclaration:this.stateInDeclaration(t);break;case c.BeforeDeclaration:this.stateBeforeDeclaration(t);break;case c.BeforeComment:this.stateBeforeComment(t);break;case c.InProcessingInstruction:this.stateInProcessingInstruction(t);break;case c.InNamedEntity:this.stateInNamedEntity(t);break;case c.BeforeEntity:this.stateBeforeEntity(t);break;case c.InHexEntity:this.stateInHexEntity(t);break;case c.InNumericEntity:this.stateInNumericEntity(t);break;default:this.stateBeforeNumericEntity(t)}this.index++}this.cleanup()}finish(){this.state===c.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===c.InCommentLike?this.currentSequence===g.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===c.InNumericEntity&&this.allowLegacyEntity()||this.state===c.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===c.InTagName||this.state===c.BeforeAttributeName||this.state===c.BeforeAttributeValue||this.state===c.AfterAttributeName||this.state===c.InAttributeName||this.state===c.InAttributeValueSq||this.state===c.InAttributeValueDq||this.state===c.InAttributeValueNq||this.state===c.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,e){this.baseState!==c.Text&&this.baseState!==c.InSpecialTag?this.cbs.onattribdata(t,e):this.cbs.ontext(t,e)}emitCodePoint(t){this.baseState!==c.Text&&this.baseState!==c.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const x=new Set(["input","option","optgroup","select","button","datalist","textarea"]),I=new Set(["p"]),p=new Set(["thead","tbody"]),N=new Set(["dd","dt"]),T=new Set(["rt","rp"]),A=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",I],["h1",I],["h2",I],["h3",I],["h4",I],["h5",I],["h6",I],["select",x],["input",x],["output",x],["button",x],["datalist",x],["textarea",x],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",N],["dt",N],["address",I],["article",I],["aside",I],["blockquote",I],["details",I],["div",I],["dl",I],["fieldset",I],["figcaption",I],["figure",I],["footer",I],["form",I],["header",I],["hr",I],["main",I],["nav",I],["ol",I],["pre",I],["section",I],["table",I],["ul",I],["rt",T],["rp",T],["tbody",p],["tfoot",p]]),y=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),C=new Set(["math","svg"]),E=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),w=/\s|\//;class q{constructor(t,e={}){var i,s,n,a,r;this.options=e,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=null!=t?t:{},this.lowerCaseTagNames=null!==(i=e.lowerCaseTags)&&void 0!==i?i:!e.xmlMode,this.lowerCaseAttributeNames=null!==(s=e.lowerCaseAttributeNames)&&void 0!==s?s:!e.xmlMode,this.tokenizer=new(null!==(n=e.Tokenizer)&&void 0!==n?n:S)(this.options,this),null===(r=(a=this.cbs).onparserinit)||void 0===r||r.call(a,this)}ontext(t,e){var i,s;const n=this.getSlice(t,e);this.endIndex=e-1,null===(s=(i=this.cbs).ontext)||void 0===s||s.call(i,n),this.startIndex=e}ontextentity(t){var e,i;const s=this.tokenizer.getSectionStart();this.endIndex=s-1,null===(i=(e=this.cbs).ontext)||void 0===i||i.call(e,a(t)),this.startIndex=s}isVoidElement(t){return!this.options.xmlMode&&y.has(t)}onopentagname(t,e){this.endIndex=e;let i=this.getSlice(t,e);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)}emitOpenTag(t){var e,i,s,n;this.openTagStart=this.startIndex,this.tagname=t;const a=!this.options.xmlMode&&A.get(t);if(a)for(;this.stack.length>0&&a.has(this.stack[this.stack.length-1]);){const t=this.stack.pop();null===(i=(e=this.cbs).onclosetag)||void 0===i||i.call(e,t,!0)}this.isVoidElement(t)||(this.stack.push(t),C.has(t)?this.foreignContext.push(!0):E.has(t)&&this.foreignContext.push(!1)),null===(n=(s=this.cbs).onopentagname)||void 0===n||n.call(s,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var e,i;this.startIndex=this.openTagStart,this.attribs&&(null===(i=(e=this.cbs).onopentag)||void 0===i||i.call(e,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,e){var i,s,n,a,r,h;this.endIndex=e;let o=this.getSlice(t,e);if(this.lowerCaseTagNames&&(o=o.toLowerCase()),(C.has(o)||E.has(o))&&this.foreignContext.pop(),this.isVoidElement(o))this.options.xmlMode||"br"!==o||(null===(s=(i=this.cbs).onopentagname)||void 0===s||s.call(i,"br"),null===(a=(n=this.cbs).onopentag)||void 0===a||a.call(n,"br",{},!0),null===(h=(r=this.cbs).onclosetag)||void 0===h||h.call(r,"br",!1));else{const t=this.stack.lastIndexOf(o);if(-1!==t)if(this.cbs.onclosetag){let e=this.stack.length-t;for(;e--;)this.cbs.onclosetag(this.stack.pop(),0!==e)}else this.stack.length=t;else this.options.xmlMode||"p"!==o||(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=e+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var e,i;const s=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===s&&(null===(i=(e=this.cbs).onclosetag)||void 0===i||i.call(e,s,!t),this.stack.pop())}onattribname(t,e){this.startIndex=t;const i=this.getSlice(t,e);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i}onattribdata(t,e){this.attribvalue+=this.getSlice(t,e)}onattribentity(t){this.attribvalue+=a(t)}onattribend(t,e){var i,s;this.endIndex=e,null===(s=(i=this.cbs).onattribute)||void 0===s||s.call(i,this.attribname,this.attribvalue,t===u.Double?'"':t===u.Single?"'":t===u.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const e=t.search(w);let i=e<0?t:t.substr(0,e);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i}ondeclaration(t,e){this.endIndex=e;const i=this.getSlice(t,e);if(this.cbs.onprocessinginstruction){const t=this.getInstructionName(i);this.cbs.onprocessinginstruction(`!${t}`,`!${i}`)}this.startIndex=e+1}onprocessinginstruction(t,e){this.endIndex=e;const i=this.getSlice(t,e);if(this.cbs.onprocessinginstruction){const t=this.getInstructionName(i);this.cbs.onprocessinginstruction(`?${t}`,`?${i}`)}this.startIndex=e+1}oncomment(t,e,i){var s,n,a,r;this.endIndex=e,null===(n=(s=this.cbs).oncomment)||void 0===n||n.call(s,this.getSlice(t,e-i)),null===(r=(a=this.cbs).oncommentend)||void 0===r||r.call(a),this.startIndex=e+1}oncdata(t,e,i){var s,n,a,r,h,o,c,l,u,d;this.endIndex=e;const b=this.getSlice(t,e-i);this.options.xmlMode||this.options.recognizeCDATA?(null===(n=(s=this.cbs).oncdatastart)||void 0===n||n.call(s),null===(r=(a=this.cbs).ontext)||void 0===r||r.call(a,b),null===(o=(h=this.cbs).oncdataend)||void 0===o||o.call(h)):(null===(l=(c=this.cbs).oncomment)||void 0===l||l.call(c,`[CDATA[${b}]]`),null===(d=(u=this.cbs).oncommentend)||void 0===d||d.call(u)),this.startIndex=e+1}onend(){var t,e;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let t=this.stack.length;t>0;this.cbs.onclosetag(this.stack[--t],!0));}null===(e=(t=this.cbs).onend)||void 0===e||e.call(t)}reset(){var t,e,i,s;null===(e=(t=this.cbs).onreset)||void 0===e||e.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,null===(s=(i=this.cbs).onparserinit)||void 0===s||s.call(i,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,e){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let i=this.buffers[0].slice(t-this.bufferOffset,e-this.bufferOffset);for(;e-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,e-this.bufferOffset);return i}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var e,i;this.ended?null===(i=(e=this.cbs).onerror)||void 0===i||i.call(e,new Error(".write() after done!")):(this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++))}end(t){var e,i;this.ended?null===(i=(e=this.cbs).onerror)||void 0===i||i.call(e,new Error(".end() after done!")):(t&&this.write(t),this.ended=!0,this.tokenizer.end())}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function k(t,e){const i=new r(void 0,e);return new q(i,e).end(t),i.root}export{k as p};
