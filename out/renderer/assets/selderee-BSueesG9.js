import{p as t,n as e,c as n,s as r}from"./parseley-BjfzG1td.js";class s{constructor(e){this.branches=i(function(e){const n=e.length,r=new Array(n);for(let s=0;s<n;s++){const[n,o]=e[s],i=c(t(n));r[s]={ast:i,terminal:{type:"terminal",valueContainer:{index:s,value:o,specificity:i.specificity}}}}return r}(e))}build(t){return t(this.branches)}}function c(t){return o(t),e(t),t}function o(t){const e=[];t.list.forEach(t=>{switch(t.type){case"class":e.push({matcher:"~=",modifier:null,name:"class",namespace:null,specificity:t.specificity,type:"attrValue",value:t.name});break;case"id":e.push({matcher:"=",modifier:null,name:"id",namespace:null,specificity:t.specificity,type:"attrValue",value:t.name});break;case"combinator":o(t.left),e.push(t);break;case"universal":break;default:e.push(t)}}),t.list=e}function i(t){const e=[];for(;t.length;){const n=d(t,t=>!0,l),{matches:r,nonmatches:s,empty:c}=u(t,n);t=s,r.length&&e.push(f(n,r)),c.length&&e.push(...a(c))}return e}function a(t){const e=[];for(const n of t){const t=n.terminal;if("terminal"===t.type)e.push(t);else{const{matches:n,rest:r}=b(t.cont,t=>"terminal"===t.type);n.forEach(t=>e.push(t)),r.length&&(t.cont=r,e.push(t))}}return e}function u(t,e){const n=[],r=[],s=[];for(const c of t){const t=c.ast.list;if(t.length){(t.some(t=>l(t)===e)?n:r).push(c)}else s.push(c)}return{matches:n,nonmatches:r,empty:s}}function l(t){switch(t.type){case"attrPresence":return`attrPresence ${t.name}`;case"attrValue":return`attrValue ${t.name}`;case"combinator":return`combinator ${t.combinator}`;default:return t.type}}function f(t,e){if("tag"===t)return function(t){const e=p(t,t=>"tag"===t.type,t=>t.name);return{type:"tagName",variants:Object.entries(e).map(([t,e])=>({type:"variant",value:t,cont:i(e.items)}))}}(e);if(t.startsWith("attrValue "))return function(t,e){const n=p(e,e=>"attrValue"===e.type&&e.name===t,t=>`${t.matcher} ${t.modifier||""} ${t.value}`),r=[];for(const s of Object.values(n)){const t=s.oneSimpleSelector,e=h(t),n=i(s.items);r.push({type:"matcher",matcher:t.matcher,modifier:t.modifier,value:t.value,predicate:e,cont:n})}return{type:"attrValue",name:t,matchers:r}}(t.substring(10),e);if(t.startsWith("attrPresence "))return function(t,e){for(const n of e)y(n,e=>"attrPresence"===e.type&&e.name===t);return{type:"attrPresence",name:t,cont:i(e)}}(t.substring(13),e);if("combinator >"===t)return m(">",e);if("combinator +"===t)return m("+",e);throw new Error(`Unsupported selector kind: ${t}`)}function h(t){if("i"===t.modifier){const e=t.value.toLowerCase();switch(t.matcher){case"=":return t=>e===t.toLowerCase();case"~=":return t=>t.toLowerCase().split(/[ \t]+/).includes(e);case"^=":return t=>t.toLowerCase().startsWith(e);case"$=":return t=>t.toLowerCase().endsWith(e);case"*=":return t=>t.toLowerCase().includes(e);case"|=":return t=>{const n=t.toLowerCase();return e===n||n.startsWith(e)&&"-"===n[e.length]}}}else{const e=t.value;switch(t.matcher){case"=":return t=>e===t;case"~=":return t=>t.split(/[ \t]+/).includes(e);case"^=":return t=>t.startsWith(e);case"$=":return t=>t.endsWith(e);case"*=":return t=>t.includes(e);case"|=":return t=>e===t||t.startsWith(e)&&"-"===t[e.length]}}}function m(t,e){const n=p(e,e=>"combinator"===e.type&&e.combinator===t,t=>r(t.left)),s=[];for(const r of Object.values(n)){const t=i(r.items),e=r.oneSimpleSelector.left;s.push({ast:e,terminal:{type:"popElement",cont:t}})}return{type:"pushElement",combinator:t,cont:i(s)}}function p(t,e,n){const r={};for(;t.length;){const s=d(t,e,n),c=t=>e(t)&&n(t)===s,o=t=>t.ast.list.some(c),{matches:i,rest:a}=w(t,o);let u=null;for(const t of i){const e=y(t,c);u||(u=e)}if(null==u)throw new Error("No simple selector is found.");r[s]={oneSimpleSelector:u,items:i},t=a}return r}function y(t,e){const n=t.ast.list,r=new Array(n.length);let s=-1;for(let o=n.length;o-- >0;)e(n[o])&&(r[o]=!0,s=o);if(-1==s)throw new Error("Couldn't find the required simple selector.");const c=n[s];return t.ast.list=n.filter((t,e)=>!r[e]),c}function d(t,e,n){const r={};for(const o of t){const t={};for(const r of o.ast.list.filter(e))t[n(r)]=!0;for(const e of Object.keys(t))r[e]?r[e]++:r[e]=1}let s="",c=0;for(const o of Object.entries(r))o[1]>c&&(s=o[0],c=o[1]);return s}function b(t,e){const n=[],r=[];for(const s of t)e(s)?n.push(s):r.push(s);return{matches:n,rest:r}}function w(t,e){const n=[],r=[];for(const s of t)e(s)?n.push(s):r.push(s);return{matches:n,rest:r}}class g{constructor(t){this.f=t}pickAll(t){return this.f(t)}pick1(t,e=!1){const n=this.f(t),r=n.length;if(0===r)return null;if(1===r)return n[0].value;const s=e?v:C;let c=n[0];for(let o=1;o<r;o++){const t=n[o];s(c,t)&&(c=t)}return c.value}}function v(t,e){const r=n(e.specificity,t.specificity);return r>0||0===r&&e.index<t.index}function C(t,e){const r=n(e.specificity,t.specificity);return r>0||0===r&&e.index>t.index}export{s as D,g as P};
