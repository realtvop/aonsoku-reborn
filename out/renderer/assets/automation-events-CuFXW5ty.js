const t=(t,e,a)=>({endTime:e,insertTime:a,type:"exponentialRampToValue",value:t}),e=(t,e,a)=>({endTime:e,insertTime:a,type:"linearRampToValue",value:t}),a=(t,e)=>({startTime:e,type:"setValue",value:t}),i=(t,e,a)=>({duration:a,startTime:e,type:"setValueCurve",values:t}),n=(t,e,{startTime:a,target:i,timeConstant:n})=>i+(e-i)*Math.exp((a-t)/n),s=t=>"exponentialRampToValue"===t.type,o=t=>"linearRampToValue"===t.type,u=t=>s(t)||o(t),l=t=>"setValue"===t.type,r=t=>"setValueCurve"===t.type,m=(t,e,a,i)=>{const s=t[e];return void 0===s?i:u(s)||l(s)?s.value:r(s)?s.values[s.values.length-1]:n(a,m(t,e-1,s.startTime,i),s)},v=(t,e,a,i,n)=>void 0===a?[i.insertTime,n]:u(a)?[a.endTime,a.value]:l(a)?[a.startTime,a.value]:r(a)?[a.startTime+a.duration,a.values[a.values.length-1]]:[a.startTime,m(t,e-1,a.startTime,n)],h=t=>"cancelAndHold"===t.type,d=t=>"cancelScheduledValues"===t.type,T=t=>h(t)||d(t)?t.cancelTime:s(t)||o(t)?t.endTime:t.startTime,c=(t,e,a,{endTime:i,value:n})=>a===n?n:0<a&&0<n||a<0&&n<0?a*(n/a)**((t-e)/(i-e)):0,_=(t,e,a,{endTime:i,value:n})=>a+(t-e)/(i-e)*(n-a),f=(t,{duration:e,startTime:a,values:i})=>((t,e)=>{const a=Math.floor(e),i=Math.ceil(e);return a===i?t[a]:(1-(e-a))*t[a]+(1-(i-e))*t[i]})(i,(t-a)/e*(i.length-1)),E=t=>"setTarget"===t.type;class p{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(n){const l=T(n);if(h(n)||d(n)){const o=this._automationEvents.findIndex(t=>d(n)&&r(t)?t.startTime+t.duration>=l:T(t)>=l),m=this._automationEvents[o];if(-1!==o&&(this._automationEvents=this._automationEvents.slice(0,o)),h(n)){const n=this._automationEvents[this._automationEvents.length-1];if(void 0!==m&&u(m)){if(void 0!==n&&E(n))throw new Error("The internal list is malformed.");const a=void 0===n?m.insertTime:r(n)?n.startTime+n.duration:T(n),i=void 0===n?this._defaultValue:r(n)?n.values[n.values.length-1]:n.value,o=s(m)?c(l,a,i,m):_(l,a,i,m),u=s(m)?t(o,l,this._currenTime):e(o,l,this._currenTime);this._automationEvents.push(u)}if(void 0!==n&&E(n)&&this._automationEvents.push(a(this.getValue(l),l)),void 0!==n&&r(n)&&n.startTime+n.duration>l){const t=l-n.startTime,e=(n.values.length-1)/n.duration,a=Math.max(2,1+Math.ceil(t*e)),s=t/(a-1)*e,o=n.values.slice(0,a);if(s<1)for(let i=1;i<a;i+=1){const t=s*i%1;o[i]=n.values[i-1]*(1-t)+n.values[i]*t}this._automationEvents[this._automationEvents.length-1]=i(o,n.startTime,t)}}}else{const a=this._automationEvents.findIndex(t=>T(t)>l),i=-1===a?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[a-1];if(void 0!==i&&r(i)&&T(i)+i.duration>l)return!1;const u=s(n)?t(n.value,n.endTime,this._currenTime):o(n)?e(n.value,l,this._currenTime):n;if(-1===a)this._automationEvents.push(u);else{if(r(n)&&l+n.duration>T(this._automationEvents[a]))return!1;this._automationEvents.splice(a,0,u)}}return!0}flush(t){const e=this._automationEvents.findIndex(e=>T(e)>t);if(e>1){const t=this._automationEvents.slice(e-1),i=t[0];E(i)&&t.unshift(a(m(this._automationEvents,e-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=t}}getValue(t){if(0===this._automationEvents.length)return this._defaultValue;const e=this._automationEvents.findIndex(e=>T(e)>t),a=this._automationEvents[e],i=(-1===e?this._automationEvents.length:e)-1,h=this._automationEvents[i];if(void 0!==h&&E(h)&&(void 0===a||!u(a)||a.insertTime>t))return n(t,m(this._automationEvents,i-1,h.startTime,this._defaultValue),h);if(void 0!==h&&l(h)&&(void 0===a||!u(a)))return h.value;if(void 0!==h&&r(h)&&(void 0===a||!u(a)||h.startTime+h.duration>t))return t<h.startTime+h.duration?f(t,h):h.values[h.values.length-1];if(void 0!==h&&u(h)&&(void 0===a||!u(a)))return h.value;if(void 0!==a&&s(a)){const[e,n]=v(this._automationEvents,i,h,a,this._defaultValue);return c(t,e,n,a)}if(void 0!==a&&o(a)){const[e,n]=v(this._automationEvents,i,h,a,this._defaultValue);return _(t,e,n,a)}return this._defaultValue}}const V=t=>({cancelTime:t,type:"cancelAndHold"}),g=t=>({cancelTime:t,type:"cancelScheduledValues"}),y=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),x=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),R=(t,e,a)=>({startTime:e,target:t,timeConstant:a,type:"setTarget"});export{p as A,a,R as b,i as c,x as d,y as e,g as f,V as g};
