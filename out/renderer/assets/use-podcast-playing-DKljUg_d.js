import{r as s}from"./react-BohqOKG4.js";import{p as e}from"./podcasts-CyXJRW_v.js";import{ae as t,u as a,t as o,Y as n,l as r}from"./index-Dw_5HS3q.js";import{a as i}from"./convertSecondsToTime-B1d9sDyx.js";import{u as c}from"./react-i18next-CJXO39OJ.js";function l({duration:s,playback:e,showFullTime:t=!1}){const a=i(s,t),o=1===e.length,n=!!o&&e[0].completed,r=o?s-e[0].progress:0,c=i(r,t),l=o?e[0].progress:0;return{episodeDuration:a,hasPlaybackData:o,isEpisodeCompleted:n,remainingTime:r,remainingTimeText:c,listeningProgress:l,listeningProgressPercentage:l/s*100}}function d(e){const{t:a}=c();return{episodeReleaseDate:s.useCallback(()=>{const s=t(),o=t(e),n=s.diff(o,"days");if(s.year()!==o.year())return o.format("L");if(n>15)return o.format("DD MMM");const r=t().from(o,!0);return a("table.lastPlayed",{date:r})},[e,a])()}}function p({id:e}){const{podcastList:t,currentSongIndex:r}=a(),i=o(),{isPodcast:c}=n(),l=s.useMemo(()=>{if(!c)return!1;const s=t[r]??null;return!!s&&s.id===e},[r,e,c,t]),d=s.useMemo(()=>l&&!i||!l,[l,i]);return{isPlaying:i,isEpisodePlaying:l,isNotPlaying:d}}async function u(s){const t=await e.getEpisode(s);if(t){t.description="",t.podcast.description="";const{playback:s}=t,e=function({playback:s}){const e=s.length>0;let t=e?s[0].progress:0;const a=!!e&&s[0].completed;return e&&a&&(t=0),t}({playback:s});return{episode:t,progress:e}}return{episode:null,progress:0}}function g({id:e}){const{setPlayPodcast:t,setPlayingState:a}=r(),{isPlaying:o,isEpisodePlaying:n}=p({id:e});return{handlePlayEpisode:s.useCallback(async s=>{if(s.stopPropagation(),s.preventDefault(),o&&n)return void a(!1);if(!o&&n)return void a(!0);const{episode:r,progress:i}=await u(e);r&&t([r],0,i)},[e,n,o,t,a])}}function f({id:e}){const{setNextPodcast:t,setLastPodcast:a}=r();return{handlePlayNext:s.useCallback(async()=>{const{episode:s,progress:a}=await u(e);s&&t(s,a)},[e,t]),handlePlayLast:s.useCallback(async()=>{const{episode:s,progress:t}=await u(e);s&&a(s,t)},[e,a])}}export{p as a,g as b,d as c,f as d,l as u};
