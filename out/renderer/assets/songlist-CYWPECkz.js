import{j as t}from"./react-BohqOKG4.js";import{u as s,e}from"./@tanstack-3eZgfo06.js";import{u as a}from"./react-router-dom-DLqO9Z-p.js";import{S as r,H as o}from"./header-title-BpiRIAyn.js";import{F as i,B as n,aC as l,b0 as c,b1 as m,a1 as d,a2 as j,a3 as p,a4 as u,ah as g,b as f,l as h,aD as x,aF as y,aN as b}from"./index-Dw_5HS3q.js";import{u as w}from"./react-i18next-CJXO39OJ.js";import{ae as v,a4 as N,a3 as P,a5 as C}from"./lucide-react-DrCvGt71.js";import{E as k}from"./expandable-input-BTLclRgg.js";import{D as S}from"./data-table-list-CEoMo1BX.js";import{b as A}from"./convertSecondsToTime-B1d9sDyx.js";import{q}from"./queryKeys-DxXuT4IC.js";import{s as F}from"./songs-columns-DLWRqf9R.js";import{a as z,s as B}from"./songs-B6goz9CI.js";import"./crypto-js-jXt9otfP.js";import"./react-dom-DeCT9Zg9.js";import"./scheduler-CuPG8W_I.js";import"./react-router-C-_aAzNf.js";import"./@remix-run-C5FxfqAA.js";import"./react-lazy-load-image-component-DTPOgetJ.js";import"./react-toastify-Dcxz3wpx.js";import"./clsx-BeLtu-UY.js";import"./i18next-CM37CVQ3.js";import"./i18next-browser-languagedetector-F0gxWJsw.js";import"./react-device-detect-CHs-JbVH.js";import"./ua-parser-js-oxSasMdn.js";import"./tailwind-extended-shadows-merge-DdKC4l0c.js";import"./tailwind-merge-5Glu2Zmz.js";import"./@radix-ui-LgTM4vlv.js";import"./aria-hidden-DyxP-6dL.js";import"./react-remove-scroll-yCREhh_0.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BNI7vDx9.js";import"./react-style-singleton-C1oTdtRg.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-DQWw4Coi.js";import"./use-callback-ref-DIudPNPV.js";import"./@floating-ui-VDk0qcgD.js";import"./use-sync-external-store-C4iHanJs.js";import"./class-variance-authority-DO3vQtTq.js";import"./lodash-DSAJ3Ow_.js";import"./zustand-Bqgea8iK.js";import"./immer-Dwi4ZIhD.js";import"./dayjs-BG2b1roC.js";import"./idb-keyval-PpvEIwUC.js";import"./fast-average-color-Dy3p1ZbH.js";import"./@hookform-CXDBdaWi.js";import"./react-hook-form-C23o4OKy.js";import"./use-debounce-CVLZIJWc.js";import"./zod-DxP4i6Pi.js";import"./react-country-flag-DV3c0LTu.js";import"./react-hotkeys-hook-qKPfarcW.js";import"./play-button-BMYlYUiF.js";import"./equalizer-bars-BP_G2EY6.js";import"./cmdk-DpOb1GNg.js";import"./command-9rYDq5Wc.js";import"./song-title-ClQcdcyq.js";import"./dot-Ccno5lbS.js";import"./cover-image-zpWg5P0A.js";import"./action-button-BoxuniMX.js";import"./like-button-BExMQkwT.js";import"./data-table-column-header-Bz-4KByJ.js";function D(){const{t:s}=w(),[,e]=a();return t.jsx(i,{text:s("songs.list.filter.clear"),side:"left",children:t.jsx(n,{variant:"outline",size:"icon",className:"w-9 h-9",onClick:function(){e(new URLSearchParams)},children:t.jsx(v,{className:"w-4 h-4 text-muted-foreground"})})})}function T({defaultSort:s=c.Desc}){const{t:e}=w(),[r,o]=a(),{getSearchParam:m}=new l(r),{Asc:d,Desc:j}=c,p=m("sort",s)===j;return t.jsx(i,{text:e(p?"table.sort.asc":"table.sort.desc"),children:t.jsx(n,{variant:"outline",className:"w-9 h-9 p-0",size:"sm",onClick:function(){o(t=>(t.set("sort",p?d:j),t))},children:p?t.jsx(N,{className:"w-4 h-4"}):t.jsx(P,{className:"w-4 h-4"})})})}function L(){const{t:s}=w(),[e,r]=a(),{getSearchParam:o}=new l(e),{LastAdded:i,Artist:c,Title:g,Album:f}=m,h=o("orderBy",i);const x=[{label:"songs.sort.lastAdded",option:i},{label:"songs.sort.artist",option:c},{label:"songs.sort.title",option:g},{label:"songs.sort.album",option:f}];return t.jsxs(d,{children:[t.jsx(j,{asChild:!0,children:t.jsx(n,{variant:"outline",className:"w-9 h-9 p-0",size:"sm",children:t.jsx(C,{className:"w-4 h-4"})})}),t.jsx(p,{align:"end",className:"w-[200px]",children:x.map(({label:e,option:a})=>t.jsx(u,{checked:h===a,onCheckedChange:()=>{return t=a,void r(s=>(s.set("orderBy",t),s));var t},children:s(e)},a))})]})}async function K(t,s){const e=await f.search.get({artistCount:0,albumCount:0,songCount:s,songOffset:t});return e?.song??[]}async function O(){const t=g.getState().data.songCount;if(t&&t>0)return t;const s=100;let e=0,a=s;for(;;){if((await K(a,s)).length<s)break;e=a,a*=2}let r=e;for(;e<a;){const t=Math.floor((e+a)/2);(await K(t,s)).length<s?a=t:e=t+s,r=a}const o=await K(r,s);return o.length>0&&(r+=o.length),g.setState(t=>{t.data.songCount=r}),r}function I(){const{t:i}=w(),{setSongList:n}=h(),[d]=a(),{getSearchParam:j}=new l(d),p=F(),u=j(x.MainFilter,""),g=j(x.Query,""),f=j(x.ArtistId,""),v=j(x.ArtistName,""),N=j("orderBy",m.LastAdded),P=j("sort",c.Desc),C=u===y.Search&&""!==g,K=""!==f&&""!==v,I=C||K;const{data:M,isLoading:E,isFetchingNextPage:G,fetchNextPage:H,hasNextPage:R}=e({queryKey:[q.song.all,u,g,f,N,P],initialPageParam:0,queryFn:async function({pageParam:t=0}){return K?z(f,{orderBy:N,sort:P}):B({query:C?g:"",songCount:100,songOffset:t,orderBy:N,sort:P})},getNextPageParam:t=>t.nextOffset}),{data:U,isLoading:X}=s({queryKey:[q.song.count],queryFn:O,staleTime:A(5),gcTime:A(5)});if(E&&!G)return t.jsx(b,{});if(!M)return null;const _=M.pages.flatMap(t=>t.songs)??[],J=(I?_.length:U)??0;const Q=K?i("songs.list.byArtist",{artist:v}):i("sidebar.songs");return t.jsxs("div",{className:"w-full h-content",children:[t.jsxs(r,{showGlassEffect:!1,fixed:!1,className:"relative w-full justify-between items-center",children:[t.jsx(o,{title:Q,count:J,loading:X}),t.jsxs("div",{className:"flex gap-2 flex-1 justify-end",children:[K&&t.jsx(D,{}),t.jsx(k,{placeholder:i("songs.list.search.placeholder")}),t.jsx(T,{}),t.jsx(L,{})]})]}),t.jsx("div",{className:"w-full h-[calc(100%-80px)] overflow-auto",children:t.jsx(S,{columns:p,data:_,handlePlaySong:t=>{return s=t.index,void(_&&n(_,s));var s},columnFilter:["index","title","album","duration","playCount","played","contentType","select"],fetchNextPage:H,hasNextPage:R})})]})}export{I as default};
