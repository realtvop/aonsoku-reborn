import{r as e,j as o}from"./react-BohqOKG4.js";import{i as n}from"./resize-observer-polyfill-C7U_o75s.js";import{p as t,L as r}from"./clrc-CLpXzmdn.js";const l="react-lrc-line",s={outline:"none",boxSizing:"border-box",scrollBehavior:"smooth",overflow:"auto"};var c=e.memo(e.forwardRef(function({style:n,...t},r){const l=e.useMemo(()=>({...s,...n}),[n]);return o.jsx("div",{...t,style:l,ref:r})}));const i={height:"50%"};var u=e.memo(function(){return o.jsx("div",{style:i})});const a=-1,f=!1,d=5e3,m=!1;function h(e,o=100){let n=0;return(...t)=>{const r=Date.now();if(r-n>=o)return n=r,e(...t)}}const v=[" ","ArrowUp","ArrowDown"];function p(o){const n=e.useRef();n.current=o;return e.useCallback((...e)=>n.current(...e),[])}var M=({root:o,autoScroll:t,lineIndex:r,lines:s,verticalSpace:c})=>{const i=e.useRef(new Map),u=e.useCallback(()=>{if(!o)return;const e=i.current.get(r);o.scrollTop=e?e.offsetTop-.5*o.clientHeight+e.height/2:0},[r,o]);e.useLayoutEffect(()=>{if(o){const e=()=>{const e=new Map,n=o.querySelectorAll(`.${l}`);for(let o=0,{length:t}=n;o<t;o+=1){const t=n[o];e.set(o,{height:t.clientHeight,offsetTop:t.offsetTop})}i.current=e};e();const t=new n(function(e,o=300){let n;return(...t)=>{globalThis.clearTimeout(n),n=globalThis.setTimeout(()=>e(t),o)}}(e));return t.observe(o),()=>t.disconnect()}},[o,s,c]),e.useLayoutEffect(()=>{t&&u()},[t,u,s,c])};const w=o.jsx(u,{});var g=e.forwardRef(function({lines:n,lineRenderer:t,currentMillisecond:r=a,verticalSpace:s=f,recoverAutoScrollInterval:i=d,recoverAutoScrollSingal:u=m,onLineUpdate:g,onAutoScrollChange:S,onWheel:b,onKeyDown:x,onPointerDown:y,onPointerUp:T,onPointerMove:A,...P},R){const j=e.useRef(null),C=function(e,o){let n=0;for(const{length:t}=e;n<=t;n+=1){const t=e[n];if(!t||t.startMillisecond>o)break}return n-1}(n,r),{autoScroll:D,onWheel:I,onKeyDown:k,onPointerDown:L,onPointerUp:E,onPointerMove:U}=(({recoverAutoScrollInterval:o,recoverAutoScrollSingal:n,onAutoScrollChange:t})=>{const[r,l]=e.useState(!0),s=e.useRef(),c=e.useCallback(()=>{globalThis.clearTimeout(s.current),l(!1),s.current=globalThis.setTimeout(()=>l(!0),o)},[o]),i=e.useRef(!1),u=e.useCallback(()=>{i.current=!0},[]),a=e.useCallback(()=>{i.current=!1},[]),f=e.useMemo(()=>h(()=>{i.current&&c()}),[c]),d=e.useMemo(()=>h(e=>{v.includes(e.key)&&c()}),[c]),m=e.useMemo(()=>h(c),[c]);return e.useEffect(()=>{l(!0)},[n]),e.useEffect(()=>{t&&t({autoScroll:r})},[r,t]),e.useEffect(()=>()=>globalThis.clearTimeout(s.current),[]),{autoScroll:r,onWheel:m,onKeyDown:d,onPointerDown:u,onPointerUp:a,onPointerMove:f}})({recoverAutoScrollInterval:i,recoverAutoScrollSingal:u,onAutoScrollChange:S});M({root:j.current,autoScroll:D,lineIndex:C,lines:n,verticalSpace:s}),e.useEffect(()=>{g&&g({index:C,line:n[C]??null})},[g,C,n]),e.useImperativeHandle(R,()=>j.current);const N=p(e=>(I(),b&&b(e))),K=p(e=>(k(e),x&&x(e))),W=p(e=>(L(),y?.(e))),H=p(e=>(E(),T?.(e))),z=p(e=>(U(),A?.(e))),Y=e.useMemo(()=>n.map((e,n)=>o.jsx("div",{className:l,children:t({index:n,active:C===n,line:e})},e.id)),[C,t,n]);return o.jsxs(c,{tabIndex:-1,...P,onWheel:N,onKeyDown:K,onPointerDown:W,onPointerUp:H,onPointerMove:z,ref:j,children:[s?w:null,Y,s?w:null]})});function S(){return Math.random().toString(36).substring(2,8)}var b=e.forwardRef(({lrc:n,...l},s)=>{const c=function(o){return e.useMemo(()=>t(o).filter(e=>e.type===r.LYRIC).map(e=>({id:S(),lineNumber:e.lineNumber,raw:e.raw,startMillisecond:e.startMillisecond,content:e.content})).sort((e,o)=>e.startMillisecond-o.startMillisecond),[o])}(n);return o.jsx(g,{...l,lines:c,ref:s})});e.forwardRef(function({lrcs:n,...l},s){const c=(o=>e.useMemo(()=>{const e=new Map;for(const n of o){const o=t(n).filter(e=>e.type===r.LYRIC);for(const n of o){const o=e.get(n.startMillisecond)||{id:S(),startMillisecond:n.startMillisecond,children:[]};o.children.push({id:S(),lineNumber:n.lineNumber,raw:n.raw,content:n.content}),e.set(n.startMillisecond,o)}}return[...e.values()].sort((e,o)=>e.startMillisecond-o.startMillisecond)},[o.length,...o]))(n);return o.jsx(g,{...l,lines:c,ref:s})});export{b as L};
