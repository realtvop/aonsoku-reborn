import{j as s,r as e}from"./react-BohqOKG4.js";import{d as t,c as a,e as r}from"./@tanstack-3eZgfo06.js";import{d as o}from"./lodash-DSAJ3Ow_.js";import{u as i}from"./react-router-dom-DLqO9Z-p.js";import{X as c,ab as l,ac as n,ad as d,D as m,ar as p,B as j,b0 as f,aC as u,b4 as x,a1 as h,a2 as g,a3 as y,a4 as N,aA as b,aD as v,aF as w,aI as P,b5 as S,R as C}from"./index-Dw_5HS3q.js";import{E as k}from"./empty-wrapper-DCqAaDSN.js";import{S as E,H as z}from"./header-title-BpiRIAyn.js";import{q as O}from"./queryKeys-DxXuT4IC.js";import{t as T}from"./@hookform-CXDBdaWi.js";import{u as _}from"./react-hook-form-C23o4OKy.js";import{B as q}from"./react-toastify-Dcxz3wpx.js";import{F as L,a as F,b as R,c as U,d as A,e as B}from"./form-Db6hBv4K.js";import{T as D}from"./textarea-C40WEtvn.js";import{p as I}from"./podcasts-CyXJRW_v.js";import{u as H}from"./react-i18next-CJXO39OJ.js";import{z as K,a5 as Q,R as G,d as J,Y as M}from"./lucide-react-DrCvGt71.js";import{o as V,s as W}from"./zod-DxP4i6Pi.js";import{E as Y}from"./expandable-input-BTLclRgg.js";import{D as $}from"./episodes-filters-OaOobcWY.js";import{b as X}from"./react-lazy-load-image-component-DTPOgetJ.js";import{P as Z}from"./card-_SOi_N1H.js";import{s as ss,a as es}from"./podcasts-CYE4JVOZ.js";import{g as ts}from"./scrollPageToTop-WHsCYcia.js";import"./crypto-js-jXt9otfP.js";import"./react-dom-DeCT9Zg9.js";import"./scheduler-CuPG8W_I.js";import"./react-router-C-_aAzNf.js";import"./@remix-run-C5FxfqAA.js";import"./i18next-CM37CVQ3.js";import"./i18next-browser-languagedetector-F0gxWJsw.js";import"./react-device-detect-CHs-JbVH.js";import"./ua-parser-js-oxSasMdn.js";import"./clsx-BeLtu-UY.js";import"./tailwind-extended-shadows-merge-DdKC4l0c.js";import"./tailwind-merge-5Glu2Zmz.js";import"./@radix-ui-LgTM4vlv.js";import"./aria-hidden-DyxP-6dL.js";import"./react-remove-scroll-yCREhh_0.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BNI7vDx9.js";import"./react-style-singleton-C1oTdtRg.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-DQWw4Coi.js";import"./use-callback-ref-DIudPNPV.js";import"./@floating-ui-VDk0qcgD.js";import"./use-sync-external-store-C4iHanJs.js";import"./class-variance-authority-DO3vQtTq.js";import"./zustand-Bqgea8iK.js";import"./immer-Dwi4ZIhD.js";import"./dayjs-BG2b1roC.js";import"./idb-keyval-PpvEIwUC.js";import"./fast-average-color-Dy3p1ZbH.js";import"./use-debounce-CVLZIJWc.js";import"./react-country-flag-DV3c0LTu.js";const as=W().url({message:"podcasts.form.dialog.validations.url"}).min(10,{message:"podcasts.form.dialog.validations.urlLength"}).refine(s=>/^https?:\/\//.test(s),{message:"podcasts.form.dialog.validations.protocol"}),rs=V({feedUrl:W({message:"podcasts.form.dialog.validations.atLeastOneUrl"}).transform(s=>s.replace(" ","\n").split("\n").map(s=>s.trim()).filter(s=>""!==s)).refine(s=>s.length>0,{message:"podcasts.form.dialog.validations.atLeastOneUrl"}).refine(s=>s.every(s=>as.safeParse(s).success),{message:"podcasts.form.dialog.validations.url"})}),os={feedUrl:[""]};function is({open:e,setOpen:a}){const{t:r}=H(),o=_({resolver:T(rs),defaultValues:os}),i=t({mutationFn:I.create,onSuccess:()=>{q.success(r("podcasts.form.toasts.success")),a(!1)},onError:s=>{c.error("[PodcastForm] - Error creating podcast",{error:s}),q.error(r("podcasts.form.toasts.error"))}});return s.jsx(l,{defaultOpen:!1,open:e,onOpenChange:s=>{a(s),o.reset(os)},children:s.jsx(n,{className:"max-w-[500px]","aria-describedby":void 0,children:s.jsx(L,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(function({feedUrl:s}){c.info("[PodcastForm] - Sent body:",{body:s}),i.mutate({feed_urls:s})}),children:[s.jsx(d,{children:s.jsx(m,{children:r("podcasts.form.dialog.title")})}),s.jsx("div",{className:"my-4 space-y-4",children:s.jsx(F,{control:o.control,name:"feedUrl",render:({field:e})=>s.jsxs(R,{children:[s.jsx(U,{className:"required",children:r("podcasts.form.dialog.feedUrl")}),s.jsx(A,{children:s.jsx(D,{...e,id:"feed-url",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,autoComplete:"off",className:"max-h-[160px]"})}),s.jsx("p",{className:"text-sm text-muted-foreground",children:r("podcasts.form.dialog.message")}),s.jsx(B,{})]})})}),s.jsx(p,{children:s.jsxs(j,{type:"submit",disabled:i.isPending,children:[i.isPending&&s.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}),s.jsx("span",{children:r("podcasts.form.dialog.saveButton")})]})})]})})})})}function cs(){const{t:e}=H();return s.jsxs(s.Fragment,{children:[s.jsx(Y,{placeholder:e("podcasts.form.search")}),s.jsx($,{defaultSort:f.Asc}),s.jsx(ls,{})]})}function ls(){const{t:e}=H(),[t,a]=i(),{getSearchParam:r}=new u(t),{EpisodeCount:o,Title:c}=x,l=r("orderBy",c);const n=[{label:"title",option:c},{label:"episodeCount",option:o}];return s.jsxs(h,{children:[s.jsx(g,{asChild:!0,children:s.jsx(j,{variant:"outline",className:"w-9 h-9 p-0",size:"sm",children:s.jsx(Q,{className:"w-4 h-4"})})}),s.jsx(y,{align:"end",className:"w-[200px]",children:n.map(({label:t,option:r})=>s.jsx(N,{checked:l===r,onCheckedChange:()=>{return s=r,void a(e=>(e.set("orderBy",s),e));var s},children:e(`podcasts.filters.podcasts.orderBy.${t}`)},r))})]})}function ns(){const{t:t}=H(),[r,o]=e.useState(!1),i=a();return s.jsxs(E,{children:[s.jsxs("div",{className:"w-full flex justify-between",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(z,{title:t("sidebar.podcasts")}),s.jsx(j,{variant:"ghost",size:"icon",className:"rounded-full",onClick:function(){i.invalidateQueries({queryKey:[O.podcast.all]},{cancelRefetch:!0})},children:s.jsx(G,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(cs,{}),s.jsxs(j,{size:"sm",variant:"default",className:"px-4",onClick:()=>o(!0),children:[s.jsx(J,{className:"w-5 h-5 -ml-[3px]"}),s.jsx("span",{className:"ml-2",children:t("podcasts.form.addButton")})]})]})]}),s.jsx(is,{open:r,setOpen:o})]})}function ds(){const{t:e}=H();return s.jsxs("div",{className:"w-full h-content",children:[s.jsx(ns,{}),s.jsx(b,{className:"pt-[--shadow-header-distance] h-full",children:s.jsx(k,{children:s.jsxs("div",{className:"text-center max-w-[500px]",children:[s.jsx("div",{className:"flex w-full justify-center items-center mb-2",children:s.jsx(M,{className:"w-8 h-8"})}),s.jsx("h3",{className:"text-2xl font-semibold tracking-tight",children:e("podcasts.emptyPage.message")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("podcasts.emptyPage.description")})]})})})]})}function ms(){const{t:e}=H();return s.jsxs("div",{className:"w-full h-content",children:[s.jsx(ns,{}),s.jsx(b,{className:"pt-[--shadow-header-distance] h-full",children:s.jsx(k,{children:s.jsxs("div",{className:"text-center max-w-[500px]",children:[s.jsx("h3",{className:"text-2xl font-semibold tracking-tight",children:e("podcasts.emptyResults.title")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("podcasts.emptyResults.info")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("podcasts.emptyResults.action")})]})})})]})}function ps({podcast:t}){const[a,r]=e.useState(t.image_url);return s.jsx(X.LazyLoadImage,{src:a,alt:t.title,effect:"opacity",width:"100%",height:"100%",className:"aspect-square object-cover w-full h-full absolute inset-0 z-0","data-testid":"podcast-card-image",onError:()=>{r("/default_podcast_art.png")}})}const{Query:js,MainFilter:fs}=v;function us(){const t=e.useRef(null),{t:a}=H(),[c]=i(),{getSearchParam:l}=new u(c),{Title:n}=x,{Asc:d}=f,m=l(fs,""),p=l("orderBy",n),j=l("sort",d),h=l(js,""),g=m===w.Search;e.useEffect(()=>{t.current=ts()},[]);const{data:y,fetchNextPage:N,hasNextPage:v,isLoading:k}=r({queryKey:[O.podcast.all,m,h,p,j],queryFn:async({pageParam:s=1})=>g&&""!==h?ss({query:h,filter_by:"title",page:s,per_page:40}):es({order_by:p,sort:j,page:s,per_page:40}),initialPageParam:1,getNextPageParam:s=>s.nextOffset});if(e.useEffect(()=>{const s=t.current;if(!s)return;const e=o(()=>{const{scrollTop:e,clientHeight:t,scrollHeight:a}=s;e+t>=a-a/4&&v&&N()},200);return s.addEventListener("scroll",e),()=>{s.removeEventListener("scroll",e)}},[N,v]),k)return s.jsx(P,{});if(!y)return s.jsx(ds,{});const E=y.pages.flatMap(s=>s.podcasts)||[];return 0===E.length?g?s.jsx(ms,{}):s.jsx(ds,{}):s.jsxs("div",{className:"w-full h-full",children:[s.jsx(ns,{}),s.jsx(b,{className:"pt-[--shadow-header-distance]",children:s.jsx(S,{"data-testid":"podcasts-grid",children:E.map(e=>s.jsxs(Z.Root,{children:[s.jsx(Z.ImageWrapper,{link:C.PODCASTS.PAGE(e.id),children:s.jsx(ps,{podcast:e})}),s.jsxs(Z.InfoWrapper,{children:[s.jsx(Z.Title,{link:C.PODCASTS.PAGE(e.id),children:e.title}),s.jsx(Z.Subtitle,{children:e.author}),s.jsx(Z.Subtitle,{className:"mt-[1px]",children:a("podcasts.header.episodeCount",{count:e.episode_count})})]})]},`podcast-${e.id}`))})})]})}export{us as default};
