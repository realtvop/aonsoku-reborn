import{a as t}from"./react-BohqOKG4.js";import{u as i}from"./use-deep-compare-uuuBiybQ.js";import{u as o}from"./use-resize-observer-mQ3-tnW6.js";var e=class{options;rowCount=0;columnCount=0;totalCount=0;totalRowCount=0;totalColumnCount=0;itemWidth=void 0;itemHeight=void 0;virtualItemWidth=0;virtualItemHeight=0;padding={};gap={};constructor(t){this.options=t,this.initOptions(),this.measure()}getPadding=t=>"object"==typeof this.options.padding?this.options.padding[t]:this.options.padding;getRowCount=(t,i)=>i&&Math.ceil(t/i)||0;getColumnCount=(t,i)=>i&&Math.ceil(t/i)||0;isPositiveInt=t=>t>=0&&Number.isInteger(t);isIndexValid=(t,i="default")=>this.isPositiveInt(t)&&t<("default"===i?this.options.count:this.totalCount);invertIndex=t=>{const i=this.totalCount-1-t;return i<0?t:i};setOptions=t=>{this.options=t,this.initOptions()};initOptions=()=>{const{gap:t,size:i}=this.options;this.padding={top:this.getPadding("top")??this.getPadding("y"),bottom:this.getPadding("bottom")??this.getPadding("y"),left:this.getPadding("left")??this.getPadding("x"),right:this.getPadding("right")??this.getPadding("x")},this.gap={x:"object"==typeof t?t.x:t,y:"object"==typeof t?t.y:t},this.itemWidth="object"==typeof i?i.width:i,this.itemHeight="object"==typeof i?i.height:i};measure=()=>{const{options:t}=this,i=t.count;if(!this.isPositiveInt(i))throw new Error(`Invalid option count -> ${i}`);const o=t.totalCount;if("number"==typeof o&&!this.isPositiveInt(o))throw new Error(`Invalid option totalCount -> ${o}`);this.totalCount=o?Math.max(i,o):i;const e=t.rows;if("number"==typeof e&&!this.isPositiveInt(e))throw new Error(`Invalid option rows -> ${e}`);const n=t.columns;if("number"==typeof n&&!this.isPositiveInt(n))throw new Error(`Invalid option columns -> ${n}`);const s=t.width?t.width-((this.padding.left??0)+(this.padding.right??0)):void 0,r=t.height?t.height-((this.padding.top??0)+(this.padding.bottom??0)):void 0;if("number"==typeof n||!n&&!this.options.horizontal)this.columnCount=n??1,this.totalColumnCount=n??1;else if(this.options.horizontal)this.columnCount=this.getColumnCount(i,e??1),this.totalColumnCount=this.getColumnCount(this.totalCount,e??1);else if("auto"===n&&s){if(!this.itemWidth||!this.isPositiveInt(this.itemWidth))throw new Error(`Invalid option itemWidth -> ${this.itemWidth}`);if(this.columnCount=Math.floor(s/this.itemWidth),this.gap.x){const t=s-(this.columnCount-1)*this.gap.x;this.columnCount=Math.floor(t/this.itemWidth)}this.totalColumnCount=this.columnCount}if(void 0!==e||this.options.horizontal?(this.rowCount=e??1,this.totalRowCount=e??1):this.options.horizontal||(this.rowCount=this.getRowCount(i,this.columnCount),this.totalRowCount=this.getRowCount(this.totalCount,this.columnCount)),"auto"!==n&&void 0!==this.itemWidth)this.virtualItemWidth=this.itemWidth;else if(this.options.horizontal&&this.rowCount&&r){const t=r-(this.rowCount-1)*(this.gap.y??0);this.virtualItemWidth=t/this.rowCount}else if(this.columnCount&&s){const t=s-(this.columnCount-1)*(this.gap.x??0);this.virtualItemWidth=t/this.columnCount}if(void 0!==this.itemHeight)this.virtualItemHeight=this.itemHeight;else if(this.options.horizontal){if(this.rowCount&&r){const t=r-(this.rowCount-1)*(this.gap.y??0);this.virtualItemHeight=t/this.rowCount}}else this.virtualItemHeight=this.virtualItemWidth};getItemPosition=t=>{if(!this.isIndexValid(t,"total"))return;this.options.invert&&(t=this.invertIndex(t));return{row:this.options.horizontal?t%this.rowCount:Math.trunc(t/this.columnCount),column:this.options.horizontal?Math.trunc(t/this.rowCount):t%this.columnCount}};getItemRect=t=>{var i,o,e,n;const s=this.getItemPosition(t);if(!s)return;const r=this.options.invert&&!this.options.horizontal?this.options.count-1-s.row:s.row,h=this.options.invert&&this.options.horizontal?this.options.count-1-s.column:s.column,l=this.virtualItemWidth?((null==(i=this.padding)?void 0:i.left)??0)+(0!==h?(null==(o=this.gap)?void 0:o.x)??0:0)*h+this.virtualItemWidth*h:0,a=this.virtualItemHeight?((null==(e=this.padding)?void 0:e.top)??0)+(0!==r?(null==(n=this.gap)?void 0:n.y)??0:0)*r+this.virtualItemHeight*r:0;return{height:this.virtualItemHeight,width:this.virtualItemWidth,top:a,bottom:a+this.virtualItemHeight,left:l,right:l+this.virtualItemWidth,x:l,y:a}};getItemHeight=t=>this.virtualItemHeight+(t>0&&this.gap.y||0);getItemWidth=t=>this.virtualItemWidth+(t>0&&this.gap.x||0);getItem=t=>{var i,o,e,n;if(!this.isIndexValid(t))return;const s=(null==(o=(i=this.options).getItemId)?void 0:o.call(i,t))??t,r=null==(n=(e=this.options).getItemData)?void 0:n.call(e,t),{row:h,column:l}=this.getItemPosition(t);return{index:t,id:s,data:r,row:h,column:l,rect:this.getItemRect(t)}};getItemIndex=(t,i)=>{const o=this.options.horizontal?i*this.rowCount+t:t*this.columnCount+i;return this.options.invert?this.invertIndex(o):o}},n=t=>{var i;if(t.totalRowCount===t.rowCount)return t.size;const o=t.getItemRect(t.rowCount*t.columnCount);if(!o)return;const e=t.size??(null==(i=t.virtualizer.scrollElement)?void 0:i.clientHeight)??0,n=t.virtualizer.getTotalSize(),s=n-o.top+e;return Math.min(n,s)},s=t=>{var i;if(t.totalColumnCount===t.columnCount)return t.size;const o=t.getItemRect(t.rowCount*t.columnCount);if(!o)return;const e=t.size??(null==(i=t.virtualizer.scrollElement)?void 0:i.clientWidth)??0,n=t.virtualizer.getTotalSize(),s=n-o.left+e;return Math.min(n,s)},r=Object.defineProperty,h=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,p=(t,i,o)=>i in t?r(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,g=(t,i)=>{for(var o in i||(i={}))u.call(i,o)&&p(t,o,i[o]);if(a)for(var o of a(i))d.call(i,o)&&p(t,o,i[o]);return t},m=(t,i)=>h(t,l(i)),c=(t,i)=>{var o={};for(var e in t)u.call(t,e)&&i.indexOf(e)<0&&(o[e]=t[e]);if(null!=t&&a)for(var e of a(t))i.indexOf(e)<0&&d.call(t,e)&&(o[e]=t[e]);return o},v=r=>{var h,l;const a=r,{scrollRef:u,overscan:d,onLoadMore:p,loadMoreSize:v}=a,f=c(a,["scrollRef","overscan","onLoadMore","loadMoreSize"]),C=f,{getItemId:I,getItemData:w,invert:z}=C,b=c(C,["getItemId","getItemData","invert"]),x=t.useReducer(()=>({}),{})[1],[y,W]=t.useState(0),[P,R]=t.useState(0),j=null!=(h=f.width)?h:y,H=null!=(l=f.height)?l:P,[O]=t.useState(()=>new e(m(g({},f),{width:j,height:H}))),M=O,{setOptions:S,measure:E}=M,$=c(M,["setOptions","measure"]);S(m(g({},f),{width:j,height:H})),i(()=>{E(),x()},[E,x,b,j,H]);const L=(t=>{if(t.horizontal)return!(void 0!==t.height||void 0!==t.rows&&t.rows<=0||"object"==typeof t.size&&void 0!==t.size.height||"number"==typeof t.size);if(void 0!==t.width)return!1;if("auto"===t.columns){if("number"==typeof t.size&&t.size<=0)return!1;if("object"==typeof t.size&&t.size.width<=0)return!1}else{if(void 0!==t.columns&&t.columns<=0)return!1;if("object"==typeof t.size&&void 0!==t.size.width)return!1;if("number"==typeof t.size)return!1}return!0})(r);o({ref:L?u:void 0,round:t.useCallback(t=>t,[]),onResize:({width:t,height:i})=>{void 0!==t&&W(t),void 0!==i&&R(i)}}),t.useLayoutEffect(()=>{const t=u.current;if(!t||!L)return;const{width:i,height:o}=t.getBoundingClientRect(),{borderLeftWidth:e,borderRightWidth:n,borderTopWidth:s,borderBottomWidth:r}=getComputedStyle(t),h=parseFloat(e)+parseFloat(n),l=parseFloat(s)+parseFloat(r);W(i-h),R(o-l)},[u,L]);const V=m(g({},(t=>({count:t.totalRowCount,estimateSize:t.getItemHeight,paddingStart:t.padding.top,paddingEnd:t.padding.bottom}))($)),{getScrollElement:()=>u.current,overscan:d}),T=m(g({},(t=>({horizontal:!0,count:t.totalColumnCount,estimateSize:t.getItemWidth,paddingStart:t.padding.left,paddingEnd:t.padding.right}))($)),{getScrollElement:()=>u.current,overscan:d});return m(g({},$),{scrollRef:u,rowVirtualizer:V,columnVirtualizer:T,getVirtualItem:t=>{const i=((t,{row:i,column:o})=>{let e;return i&&o?e=t.getItemIndex(i.index,o.index):(e=i?i.index:o.index,t.options.invert&&(e=t.invertIndex(e))),e})($,t);if(!$.isIndexValid(i))return;const{size:o,padding:e,translate:n}=((t,{row:i,column:o,scrollMargin:e})=>{const n=o&&0!==o.index&&t.gap.x||0,s=i&&0!==i.index&&t.gap.y||0,r={bottom:!i&&t.padding.bottom||0,top:!i&&t.padding.top||0,right:!o&&t.padding.right||0,left:!o&&t.padding.left||0},h=o&&t.itemWidth?(o.size-n-t.itemWidth)/2:0;return{size:{width:(null==o?void 0:o.size)??t.itemWidth,height:(null==i?void 0:i.size)??t.itemHeight},padding:{left:r.left+h+n,right:r.right+h,top:r.top+s,bottom:r.bottom},translate:{x:((null==o?void 0:o.start)??0)-((null==e?void 0:e.left)??0),y:((null==i?void 0:i.start)??0)-((null==e?void 0:e.top)??0)}}})($,t);return{index:i,style:{position:"absolute",top:"0px",left:"0px",width:void 0!==o.width?`${o.width}px`:"100%",height:void 0!==o.height?`${o.height}px`:"100%",transform:`translateX(${n.x}px) translateY(${n.y}px)`,paddingLeft:`${e.left}px`,paddingRight:`${e.right}px`,paddingTop:`${e.top}px`,paddingBottom:`${e.bottom}px`,boxSizing:"border-box"}}},getLoadMoreTrigger:({virtualizer:t}={})=>{const i=$.options.horizontal?"right":"bottom",o=$.options.horizontal?s:n;return{position:i,size:t?o(m(g({},$),{virtualizer:t,size:v})):v,onLoadMore:p}}})};export{v as u};
