import{r as e,j as s}from"./react-BohqOKG4.js";import{l as t,R as a,k as r,b as n,aC as i,aD as l,B as o,S as m,c,aE as u,F as d,aF as j,aG as p,a1 as h,a2 as x,a3 as f,a4 as b,aH as g,aA as y,aI as w}from"./index-Dw_5HS3q.js";import{P as N}from"./card-_SOi_N1H.js";import{u as v}from"./react-i18next-CJXO39OJ.js";import{E as C}from"./empty-wrapper-DCqAaDSN.js";import{u as k}from"./react-router-dom-DLqO9Z-p.js";import{S as P,H as S}from"./header-title-BpiRIAyn.js";import{E as A}from"./expandable-input-BTLclRgg.js";import{u as O,e as F}from"./@tanstack-3eZgfo06.js";import{c as z,d as E,e as G,f as I,C as q,a as B}from"./command-9rYDq5Wc.js";import{P as L,a as Y,b as M}from"./popover-CzAMUpib.js";import{q as T}from"./queryKeys-DxXuT4IC.js";import{s as R,g as H}from"./scrollPageToTop-WHsCYcia.js";import{a2 as K,c as D,a3 as U,a4 as W,a5 as Q}from"./lucide-react-DrCvGt71.js";import{G as J}from"./grid-view-wrapper-Dkq5DQS_.js";import{d as V}from"./lodash-DSAJ3Ow_.js";import"./crypto-js-jXt9otfP.js";import"./react-dom-DeCT9Zg9.js";import"./scheduler-CuPG8W_I.js";import"./react-lazy-load-image-component-DTPOgetJ.js";import"./react-toastify-Dcxz3wpx.js";import"./clsx-BeLtu-UY.js";import"./i18next-CM37CVQ3.js";import"./i18next-browser-languagedetector-F0gxWJsw.js";import"./react-device-detect-CHs-JbVH.js";import"./ua-parser-js-oxSasMdn.js";import"./tailwind-extended-shadows-merge-DdKC4l0c.js";import"./tailwind-merge-5Glu2Zmz.js";import"./@radix-ui-LgTM4vlv.js";import"./aria-hidden-DyxP-6dL.js";import"./react-remove-scroll-yCREhh_0.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BNI7vDx9.js";import"./react-style-singleton-C1oTdtRg.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-DQWw4Coi.js";import"./use-callback-ref-DIudPNPV.js";import"./@floating-ui-VDk0qcgD.js";import"./use-sync-external-store-C4iHanJs.js";import"./class-variance-authority-DO3vQtTq.js";import"./zustand-Bqgea8iK.js";import"./immer-Dwi4ZIhD.js";import"./dayjs-BG2b1roC.js";import"./idb-keyval-PpvEIwUC.js";import"./fast-average-color-Dy3p1ZbH.js";import"./@hookform-CXDBdaWi.js";import"./react-hook-form-C23o4OKy.js";import"./use-debounce-CVLZIJWc.js";import"./zod-DxP4i6Pi.js";import"./react-country-flag-DV3c0LTu.js";import"./@remix-run-C5FxfqAA.js";import"./react-router-C-_aAzNf.js";import"./cmdk-DpOb1GNg.js";import"./@virtual-grid-CgdFuaQH.js";import"./use-deep-compare-uuuBiybQ.js";import"./dequal-DoBxDInM.js";import"./use-resize-observer-mQ3-tnW6.js";import"./gridTools-sj1_E2oR.js";const Z=e.memo(function({album:e}){const{setSongList:i}=t();return s.jsxs(N.Root,{children:[s.jsxs(N.ImageWrapper,{link:a.ALBUM.PAGE(e.id),children:[s.jsx(N.Image,{src:r(e.coverArt,"album","300"),alt:e.name}),window.innerWidth>640&&s.jsx(N.PlayButton,{onClick:async function(){const s=await n.albums.getOne(e.id);s&&i(s.song,0)}})]}),s.jsxs(N.InfoWrapper,{children:[s.jsx(N.Title,{link:a.ALBUM.PAGE(e.id),children:e.name}),s.jsx(N.Subtitle,{enableLink:void 0!==e.artistId,link:a.ARTIST.PAGE(e.artistId??""),children:e.artist})]})]})});function _(){const{t:e}=v();return s.jsxs("div",{className:"text-center max-w-[500px]",children:[s.jsx("h3",{className:"text-2xl font-semibold tracking-tight",children:e("album.list.empty.title")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("album.list.empty.info")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("album.list.empty.action")})]})}function X(){const{t:t}=v(),[a,r]=e.useState(!1),[u,d]=k(),{getSearchParam:j}=new i(u),{data:p,isLoading:h}=O({queryKey:[T.genre],queryFn:n.genres.get}),x=j(l.Genre,"");return h?s.jsxs(o,{variant:"outline",size:"sm",className:"w-[220px] justify-between",disabled:!0,children:[t("album.list.genre.loading"),s.jsx(K,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}):p?s.jsxs(L,{open:a,onOpenChange:r,children:[s.jsx(Y,{asChild:!0,children:s.jsxs(o,{variant:"outline",size:"sm",role:"combobox","aria-expanded":a,className:"w-[220px] justify-between",children:[x||t("album.list.genre.label"),s.jsx(K,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),s.jsx(M,{className:"w-[220px] p-0",align:"end",children:s.jsxs(z,{children:[s.jsx(E,{placeholder:t("album.list.genre.search")}),s.jsx(m,{className:"h-[300px]",type:"always",children:s.jsxs(G,{className:"max-h-fit",children:[s.jsx(I,{children:s.jsx("div",{className:"px-2",children:t("album.list.genre.notFound")})}),s.jsx(q,{children:p.map(({value:e})=>s.jsxs(B,{value:e,onSelect:e=>function(e){d(s=>(s.set(l.Genre,e),s)),r(!1),R()}(e),className:"mr-1.5",children:[s.jsx(D,{className:c("mr-2 h-4 w-4",x===e?"opacity-100":"opacity-0")}),e]},e))})]})})]})})]}):null}function $(){const{t:e}=v(),[t,a]=k(),{getSearchParam:r}=new i(t),n=r(l.YearFilter,u.Oldest);return s.jsx(d,{text:n===u.Oldest?e("table.sort.asc"):e("table.sort.desc"),children:s.jsx(o,{variant:"outline",size:"sm",onClick:function(){a(e=>{const s=n===u.Newest?u.Oldest:u.Newest;return e.set(l.YearFilter,s),e}),R()},children:n===u.Oldest?s.jsx(U,{className:"w-4 h-4"}):s.jsx(W,{className:"w-4 h-4"})})})}const ee=[j.ByDiscography,j.Search];function se(){const{t:e}=v(),[t,a]=k(),{getSearchParam:r}=new i(t),n=r(l.MainFilter,j.RecentlyAdded),m=p.filter(e=>e.key===n)[0].label;return s.jsxs(h,{children:[s.jsx(x,{asChild:!0,children:s.jsxs(o,{variant:"outline",size:"sm",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"hidden sm:block",children:e(m)})]})}),s.jsx(f,{align:"end",children:p.map((t,r)=>ee.includes(t.key)?null:s.jsx(b,{checked:t.key===n,onCheckedChange:()=>{return e=t.key,localStorage.setItem(g.MainFilter,e),a(s=>(s.set(l.MainFilter,e),s.delete(l.ArtistId),s.delete(l.ArtistName),e!==j.ByYear&&s.delete(l.YearFilter),e!==j.ByGenre&&s.delete(l.Genre),s)),void R();var e},className:"cursor-pointer",children:e(t.label)},r))})]})}function te(){const{t:e}=v(),[t]=k(),{getSearchParam:a}=new i(t),r=a(l.MainFilter,j.RecentlyAdded);return s.jsxs("div",{className:"flex gap-2 flex-1 justify-end",children:[r===j.ByYear&&s.jsx($,{}),r===j.ByGenre&&s.jsx(X,{}),s.jsx(se,{}),s.jsx(A,{placeholder:e("album.list.search.placeholder")})]})}function ae({albumCount:e}){const{t:t}=v(),[a]=k(),{getSearchParam:r}=new i(a),n=r(l.ArtistName,""),o=t("sidebar.albums"),m=t("album.list.header.albumsByArtist",{artist:n}),c=""===n?o:m;return s.jsx(P,{children:s.jsxs("div",{className:"w-full flex justify-between",children:[s.jsx(S,{title:c,count:e}),s.jsx(te,{})]})})}function re(){return s.jsxs("div",{className:"w-full h-content",children:[s.jsx(ae,{albumCount:0}),s.jsx(y,{className:"pt-[--shadow-header-distance] h-full",children:s.jsx(C,{children:s.jsx(_,{})})})]})}const ne={albums:[],nextOffset:null,albumsCount:0};function ie(){const[s]=k(),{getSearchParam:t}=new i(s),a="0001",r=(new Date).getFullYear().toString(),o=e.useRef(null),m=t(l.MainFilter,j.RecentlyAdded),c=t(l.YearFilter,u.Oldest),d=t(l.Genre,""),p=t(l.ArtistId,""),h=t(l.Query,"");e.useEffect(()=>{o.current=H()},[]);const[x,f]=c===u.Oldest?[a,r]:[r,a];const{data:b,fetchNextPage:g,hasNextPage:y,isLoading:w}=F({queryKey:[T.album.all,m,c,d,h],queryFn:async({pageParam:e=0})=>""!==p?async function(e){const s=await n.artists.getOne(e);return s&&s.album?{albums:s.album,nextOffset:null,albumsCount:s.album.length}:ne}(p):m===j.Search&&""!==h?async function({query:e,count:s,offset:t}){const a=await n.search.get({query:e,songCount:0,artistCount:0,albumCount:s,albumOffset:t});if(!a)return ne;if(!a.album)return ne;let r=null;return a.album.length>=s&&(r=t+s),{albums:a.album,nextOffset:r,albumsCount:t+a.album.length}}({query:h,count:128,offset:e}):async function(e){const s=await n.albums.getAlbumList(e);if(!s)return ne;if(!s.list)return ne;let t=null;return s.list.length>=e.size&&(t=e.offset+e.size),{albums:s.list,nextOffset:t,albumsCount:s.albumsCount||0}}({type:m,size:128,offset:e,fromYear:x,toYear:f,genre:d}),initialPageParam:0,getNextPageParam:e=>e.nextOffset,enabled:m!==j.ByGenre||""!==d});e.useEffect(()=>{const e=o.current;if(!e)return;const s=V(()=>{const{scrollTop:s,clientHeight:t,scrollHeight:a}=e;s+t>=a-a/4&&y&&g()},200);return e.addEventListener("scroll",s),()=>{e.removeEventListener("scroll",s)}},[g,y]);const{albums:N,albumsCount:v}=b?{albums:b.pages.flatMap(e=>e.albums),albumsCount:b.pages[b.pages.length-1].albumsCount}:{albums:[],albumsCount:0};return{isLoading:w,isEmpty:0===N.length||!b,albums:N,albumsCount:v}}function le(){const{isLoading:e,isEmpty:t,albums:a,albumsCount:r}=ie();return e?s.jsx(w,{}):t?s.jsx(re,{}):s.jsxs("div",{className:"w-full h-full",children:[s.jsx(ae,{albumCount:r}),s.jsx(y,{className:"pt-[--shadow-header-distance] px-0",children:s.jsx(J,{list:a,"data-testid":"albums-grid",type:"albums",children:e=>s.jsx(Z,{album:e})})})]})}export{le as default};
