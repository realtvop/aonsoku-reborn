import{E as t,i as e}from"./domelementtype-wvvL8fxI.js";class n{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return u(this,t)}}class s extends n{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class i extends s{constructor(){super(...arguments),this.type=t.Text}get nodeType(){return 3}}class r extends s{constructor(){super(...arguments),this.type=t.Comment}get nodeType(){return 8}}class o extends s{constructor(e,n){super(n),this.name=e,this.type=t.Directive}get nodeType(){return 1}}class a extends n{constructor(t){super(),this.children=t}get firstChild(){var t;return null!==(t=this.children[0])&&void 0!==t?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class d extends a{constructor(){super(...arguments),this.type=t.CDATA}get nodeType(){return 4}}class l extends a{constructor(){super(...arguments),this.type=t.Root}get nodeType(){return 9}}class h extends a{constructor(e,n,s=[],i=("script"===e?t.Script:"style"===e?t.Style:t.Tag)){super(s),this.name=e,this.attribs=n,this.type=i}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var e,n;return{name:t,value:this.attribs[t],namespace:null===(e=this["x-attribsNamespace"])||void 0===e?void 0:e[t],prefix:null===(n=this["x-attribsPrefix"])||void 0===n?void 0:n[t]}})}}function c(t){return e(t)}function u(e,n=!1){let s;if(function(e){return e.type===t.Text}(e))s=new i(e.data);else if(function(e){return e.type===t.Comment}(e))s=new r(e.data);else if(c(e)){const t=n?p(e.children):[],i=new h(e.name,{...e.attribs},t);t.forEach(t=>t.parent=i),null!=e.namespace&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),s=i}else if(function(e){return e.type===t.CDATA}(e)){const t=n?p(e.children):[],i=new d(t);t.forEach(t=>t.parent=i),s=i}else if(function(e){return e.type===t.Root}(e)){const t=n?p(e.children):[],i=new l(t);t.forEach(t=>t.parent=i),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),s=i}else{if(!function(e){return e.type===t.Directive}(e))throw new Error(`Not implemented yet: ${e.type}`);{const t=new o(e.name,e.data);null!=e["x-name"]&&(t["x-name"]=e["x-name"],t["x-publicId"]=e["x-publicId"],t["x-systemId"]=e["x-systemId"]),s=t}}return s.startIndex=e.startIndex,s.endIndex=e.endIndex,null!=e.sourceCodeLocation&&(s.sourceCodeLocation=e.sourceCodeLocation),s}function p(t){const e=t.map(t=>u(t,!0));for(let n=1;n<e.length;n++)e[n].prev=e[n-1],e[n-1].next=e[n];return e}const x={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class m{constructor(t,e,n){this.dom=[],this.root=new l(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof e&&(n=e,e=x),"object"==typeof t&&(e=t,t=void 0),this.callback=null!=t?t:null,this.options=null!=e?e:x,this.elementCB=null!=n?n:null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new l(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(e,n){const s=this.options.xmlMode?t.Tag:void 0,i=new h(e,n,void 0,s);this.addNode(i),this.tagStack.push(i)}ontext(e){const{lastNode:n}=this;if(n&&n.type===t.Text)n.data+=e,this.options.withEndIndices&&(n.endIndex=this.parser.endIndex);else{const t=new i(e);this.addNode(t),this.lastNode=t}}oncomment(e){if(this.lastNode&&this.lastNode.type===t.Comment)return void(this.lastNode.data+=e);const n=new r(e);this.addNode(n),this.lastNode=n}oncommentend(){this.lastNode=null}oncdatastart(){const t=new i(""),e=new d([t]);this.addNode(e),t.parent=e,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,e){const n=new o(t,e);this.addNode(n)}handleCallback(t){if("function"==typeof this.callback)this.callback(t,this.dom);else if(t)throw t}addNode(t){const e=this.tagStack[this.tagStack.length-1],n=e.children[e.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),e.children.push(t),n&&(t.prev=n,n.next=t),t.parent=e,this.lastNode=null}}export{m as D,c as i};
