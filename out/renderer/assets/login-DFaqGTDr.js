import{j as e,r as s}from"./react-BohqOKG4.js";import{b as r}from"./react-lazy-load-image-component-DTPOgetJ.js";import{t as a}from"./@hookform-CXDBdaWi.js";import{c as o}from"./@tanstack-3eZgfo06.js";import{c as t}from"./clsx-BeLtu-UY.js";import{u as i}from"./react-hook-form-C23o4OKy.js";import{B as l}from"./react-toastify-Dcxz3wpx.js";import{aO as n,aP as c,aQ as d,aR as m,aS as f,aT as p,aU as u,aV as j,c as x,al as h,ag as g,am as v,B as w,ab as N,ac as b,ad as C,D as y,ar as k,aW as R,R as z,P as S}from"./index-Dw_5HS3q.js";import{R as B}from"./react-country-flag-DV3c0LTu.js";import{F as L,a as q,b as D,c as F,d as M,f as P,e as V}from"./form-Db6hBv4K.js";import{a6 as H,a7 as O,z as Z}from"./lucide-react-DrCvGt71.js";import{b as _}from"./react-router-C-_aAzNf.js";import{u as A}from"./react-i18next-CJXO39OJ.js";import{o as E,s as I}from"./zod-DxP4i6Pi.js";import"./crypto-js-jXt9otfP.js";import"./react-dom-DeCT9Zg9.js";import"./scheduler-CuPG8W_I.js";import"./i18next-CM37CVQ3.js";import"./i18next-browser-languagedetector-F0gxWJsw.js";import"./react-router-dom-DLqO9Z-p.js";import"./@remix-run-C5FxfqAA.js";import"./react-device-detect-CHs-JbVH.js";import"./ua-parser-js-oxSasMdn.js";import"./tailwind-extended-shadows-merge-DdKC4l0c.js";import"./tailwind-merge-5Glu2Zmz.js";import"./@radix-ui-LgTM4vlv.js";import"./aria-hidden-DyxP-6dL.js";import"./react-remove-scroll-yCREhh_0.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BNI7vDx9.js";import"./react-style-singleton-C1oTdtRg.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-DQWw4Coi.js";import"./use-callback-ref-DIudPNPV.js";import"./@floating-ui-VDk0qcgD.js";import"./use-sync-external-store-C4iHanJs.js";import"./class-variance-authority-DO3vQtTq.js";import"./lodash-DSAJ3Ow_.js";import"./zustand-Bqgea8iK.js";import"./immer-Dwi4ZIhD.js";import"./dayjs-BG2b1roC.js";import"./idb-keyval-PpvEIwUC.js";import"./fast-average-color-Dy3p1ZbH.js";import"./use-debounce-CVLZIJWc.js";function T(){return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(r.LazyLoadImage,{src:"data:image/svg+xml,%3csvg%20width='1024'%20height='1024'%20viewBox='0%200%201024%201024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M869.815%20512C869.815%20709.616%20709.615%20869.815%20511.999%20869.815C314.383%20869.815%20154.184%20709.616%20154.184%20512C154.184%20314.384%20314.383%20154.184%20511.999%20154.184C709.615%20154.184%20869.815%20314.384%20869.815%20512Z'%20stroke='%2320B358'%20stroke-width='30'/%3e%3cpath%20d='M843.718%20513.243C843.718%20679.232%20708.889%20813.893%20542.446%20813.893C376.002%20813.893%20241.174%20679.232%20241.174%20513.243C241.174%20347.253%20376.002%20212.592%20542.446%20212.592C708.889%20212.592%20843.718%20347.253%20843.718%20513.243Z'%20stroke='%2320B358'%20stroke-width='30'/%3e%3cpath%20d='M818.863%20515.728C818.863%20651.608%20708.983%20761.699%20573.514%20761.699C438.044%20761.699%20328.164%20651.608%20328.164%20515.728C328.164%20379.848%20438.044%20269.757%20573.514%20269.757C708.983%20269.757%20818.863%20379.848%20818.863%20515.728Z'%20stroke='%2320B358'%20stroke-width='30'/%3e%3cpath%20d='M794.009%20513.864C794.009%20618.482%20709.199%20703.291%20604.582%20703.291C499.964%20703.291%20415.155%20618.482%20415.155%20513.864C415.155%20409.246%20499.964%20324.437%20604.582%20324.437C709.199%20324.437%20794.009%20409.246%20794.009%20513.864Z'%20stroke='%2320B358'%20stroke-width='30'/%3e%3c/svg%3e",alt:"Aonsoku icon",className:"size-6"}),e.jsx("span",{className:"leading-7 text-sm font-medium text-muted-foreground",children:"Aonsoku"})]})}function U(){const{langCode:s,setLang:r,flag:a}=n();return e.jsxs(c,{value:s,onValueChange:e=>r(e),children:[e.jsx(d,{className:"w-[70px] h-8 ring-offset-transparent focus:ring-0",children:e.jsx(m,{children:e.jsx(B,{countryCode:a,svg:!0})})}),e.jsx(f,{align:"end",children:e.jsx(p,{children:u.map(r=>e.jsxs(j,{value:r.langCode,disabled:r.langCode===s,children:[e.jsx(B,{countryCode:r.flag,svg:!0}),e.jsx("span",{className:"ml-1",children:r.nativeName})]},r.langCode))})})]})}const W=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:x("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r}));W.displayName="Card";const J=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:x("flex flex-col space-y-1.5 p-6",s),...r}));J.displayName="CardHeader";const Q=s.forwardRef(({className:s,...r},a)=>e.jsx("h3",{ref:a,className:x("text-2xl font-semibold leading-none tracking-tight",s),...r}));Q.displayName="CardTitle";const Y=s.forwardRef(({className:s,...r},a)=>e.jsx("p",{ref:a,className:x("text-sm text-muted-foreground",s),...r}));Y.displayName="CardDescription";const K=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:x("p-6 pt-0",s),...r}));K.displayName="CardContent";const G=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:x("flex items-center p-6 pt-0",s),...r}));G.displayName="CardFooter";const X=s.forwardRef(({...r},a)=>{const[o,t]=s.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx(h,{ref:a,type:o?"text":"password",...r,id:"password"}),e.jsx("button",{className:"absolute inset-y-0 end-0 flex h-full w-9 items-center justify-center rounded-e-lg text-muted-foreground/80 outline-offset-2 transition-colors hover:text-foreground focus:z-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-ring/70 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",type:"button",onClick:()=>t(e=>!e),"aria-label":o?"Hide password":"Show password","aria-pressed":o,"aria-controls":"password",children:o?e.jsx(H,{size:16,strokeWidth:2,"aria-hidden":"true"}):e.jsx(O,{size:16,strokeWidth:2,"aria-hidden":"true"})})]})});function $(e){return"/"===e.slice(-1)?e.slice(0,-1):e}X.displayName="Password";const ee=E({url:I().url({message:"login.form.validations.url"}).refine(e=>/^https?:\/\//.test(e),{message:"login.form.validations.protocol"}),username:I({required_error:"login.form.validations.username"}).min(2,{message:"login.form.validations.usernameLength"}),password:I({required_error:"login.form.validations.password"}).min(2,{message:"login.form.validations.passwordLength"})}),se=S()?"http://":"https://",re=window.SERVER_URL||se,ae=re!==se;function oe(){const[r,n]=s.useState(!1),[c,d]=s.useState(!1),{saveConfig:m}=g(),{hideServer:f}=v(),p=_(),{t:u}=A(),j=o(),x=ae&&f,S=i({resolver:a(ee),values:{url:re,username:"",password:""}});async function B(e,s){n(!0);if((await R($(e.url))).protocolVersionNumber<1150&&!0!==s)return d(!0),void n(!1);d(!1);await m({...e,url:$(e.url)})?(await j.invalidateQueries(),l.success(u("toast.server.success")),p(z.LIBRARY.HOME,{replace:!0})):(n(!1),l.error(u("toast.server.error")))}return e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"max-w-[80vw] w-[450px] bg-background-foreground",children:e.jsx(L,{...S,children:e.jsxs("form",{onSubmit:S.handleSubmit(e=>B(e)),children:[e.jsxs(J,{className:"flex",children:[e.jsxs(Q,{className:"flex flex-row justify-between items-center",children:[u("login.form.server"),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx(U,{})})]}),e.jsx(Y,{children:u("login.form.description")})]}),e.jsxs(K,{className:"space-y-2",children:[e.jsx(q,{control:S.control,name:"url",render:({field:s})=>e.jsxs(D,{className:t(x&&"hidden"),children:[e.jsx(F,{className:"required",children:u("login.form.url")}),e.jsx(M,{children:e.jsx(h,{...s,id:"url",type:"text",placeholder:u("login.form.urlDescription"),autoCorrect:"false",autoCapitalize:"false",spellCheck:"false"})}),e.jsx(P,{children:u("login.form.urlDescription")}),e.jsx(V,{})]})}),e.jsx(q,{control:S.control,name:"username",render:({field:s})=>e.jsxs(D,{className:t(x&&"!mt-0"),children:[e.jsx(F,{className:"required",children:u("login.form.username")}),e.jsx(M,{children:e.jsx(h,{...s,value:s.value??"",id:"username",type:"text",placeholder:u("login.form.usernamePlaceholder"),autoCorrect:"false",autoCapitalize:"false",spellCheck:"false"})}),e.jsx(V,{})]})}),e.jsx(q,{control:S.control,name:"password",render:({field:s})=>e.jsxs(D,{children:[e.jsx(F,{className:"required",children:u("login.form.password")}),e.jsx(M,{children:e.jsx(X,{...s,value:s.value??""})}),e.jsx(V,{})]})})]}),e.jsx(G,{className:"flex",children:e.jsx(w,{type:"submit",className:"w-full",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),u("login.form.connecting")]}):e.jsx(e.Fragment,{children:u("login.form.connect")})})})]})})}),e.jsx(N,{open:c,onOpenChange:e=>{d(e)},children:e.jsxs(b,{className:"max-w-[500px]",children:[e.jsx(C,{children:e.jsx(y,{children:u("server.incompatible.title")})}),e.jsx("p",{children:u("server.incompatible.description")}),e.jsx(k,{children:e.jsx(w,{onClick:S.handleSubmit(e=>B(e,!0)),children:u("server.incompatible.skip")})})]})})]})}function te(){return e.jsxs("div",{className:"flex flex-col w-screen h-screen relative",children:[e.jsx("header",{className:"w-full flex items-center justify-center h-header px-4 fixed top-0 right-0 left-0 z-20 bg-background border-b electron-drag",children:e.jsx(T,{})}),e.jsx("main",{className:"flex flex-col w-full h-full justify-center items-center",children:e.jsx(oe,{})})]})}export{te as default};
