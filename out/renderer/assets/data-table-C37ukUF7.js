import{j as e,r as s}from"./react-BohqOKG4.js";import{r as a}from"./@chriscodesthings-bGFwLvh6.js";import{c as t}from"./clsx-BeLtu-UY.js";import{b as l}from"./react-lazy-load-image-component-DTPOgetJ.js";import{as as n,k as i,R as r,aZ as o,c,a_ as d,W as m,aP as x,aQ as u,aR as g,aS as h,aV as p,B as f,C as j,a$ as b,al as w}from"./index-Dw_5HS3q.js";import{L as v}from"./react-router-dom-DLqO9Z-p.js";import{D as N}from"./dot-Ccno5lbS.js";import{C as y}from"./lightbox-B7s_JddE.js";import{A as C}from"./song-title-ClQcdcyq.js";import{f as S,g as k,h as P,i as R,j as I,k as F}from"./@tanstack-3eZgfo06.js";import{l as M}from"./react-device-detect-CHs-JbVH.js";import{u as T}from"./react-hotkeys-hook-qKPfarcW.js";import{P as z}from"./options-hS6iO596.js";import{C as A,S as D,e as L,f as E}from"./play-button-BMYlYUiF.js";import{u as O}from"./react-i18next-CJXO39OJ.js";import{a9 as $,B as q,C as V,aa as B,X as G,ab as K}from"./lucide-react-DrCvGt71.js";function _({showFirstDot:s=!0,badges:a}){return e.jsx("div",{className:"flex text-sm",children:e.jsx(e.Fragment,{children:a.filter(e=>e.content).map((a,t,l)=>e.jsxs(e.Fragment,{children:[s&&0===t&&e.jsx(N,{}),"link"===a.type?e.jsx(v,{to:a.link,className:"flex opacity-80 drop-shadow hover:opacity-100 hover:underline",children:a.content}):e.jsx("p",{className:"opacity-80 drop-shadow",children:a.content}),t<l.length-1&&e.jsx(N,{})]},t))})})}function H(e){const s=e=>`${e} text-balance align-baseline`;return e.length<15?s("text-6xl 2xl:text-7xl leading-[4.75rem] 2xl:leading-[5.625rem]"):e.length>40?s("text-3xl 2xl:text-5xl leading-[2.65rem] 2xl:leading-[4rem]"):s("text-4xl 2xl:text-6xl leading-[3rem] 2xl:leading-[5rem]")}function W({id:s,name:a}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{id:s,name:a}),e.jsx(U,{id:s,name:a})]})}function Y({artists:s}){const a=s.slice(0,C),{isLms:t}=n();return e.jsxs("div",{className:"flex items-center gap-2",children:[!t&&e.jsx("div",{className:"flex items-center -space-x-0.5",children:a.map(({id:s,name:a})=>e.jsx("div",{className:"rounded-full",children:e.jsx(Q,{id:s,name:a})},`artist-image-${s}`))}),e.jsx("div",{className:"flex items-center",children:a.map(({id:s,name:t},l)=>e.jsxs("div",{className:"flex",children:[e.jsx(U,{id:s,name:t}),l<a.length-1&&e.jsx(N,{})]},`artist-link-${s}`))})]})}function Q({id:s,name:a}){const{isLms:t}=n();return t?null:e.jsx("div",{className:"size-6 min-w-6 min-h-6 rounded-full bg-accent drop-shadow-lg ring-1 ring-foreground/10",children:e.jsx(l.LazyLoadImage,{effect:"opacity",src:i(s,"artist","100"),alt:a,className:"w-full h-full rounded-full aspect-square object-cover shadow-custom-5"})})}function U({id:s,name:a}){return e.jsx(v,{className:"flex items-center hover:underline text-sm font-medium drop-shadow",to:r.ARTIST.PAGE(s),children:a})}function X({isPlaylist:s,artists:a,subtitle:t,artistId:l,badges:n,className:i}){const r=!!a&&a.length>1;return e.jsxs("div",{className:i,children:[!s&&a&&r&&e.jsxs("div",{className:"flex items-center mt-1 sm:mt-2",children:[e.jsx(Y,{artists:a}),e.jsx(_,{badges:n})]}),!s&&t&&!r&&e.jsx(e.Fragment,{children:l?e.jsxs("div",{className:"flex items-center mt-1 sm:mt-2",children:[e.jsx(W,{id:l,name:t}),e.jsx(_,{badges:n})]}):e.jsx("p",{className:"opacity-80 text-xs sm:text-sm font-medium",children:t})}),s&&t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs sm:text-sm opacity-80 drop-shadow line-clamp-2 mt-1 mb-1 sm:mb-2",children:t}),e.jsx(_,{badges:n,showFirstDot:!1})]}),!t&&e.jsx("div",{className:"mt-1",children:e.jsx(_,{badges:n,showFirstDot:!1})})]})}function Z({type:n,title:r,subtitle:x,artistId:u,artists:g,coverArtId:h,coverArtType:p,coverArtSize:f,coverArtAlt:j,badges:b,isPlaylist:w=!1}){const[v,N]=s.useState(!1),[C,S]=s.useState(!1),[k,P]=s.useState("");function R(){return document.getElementById("cover-art-image")}return e.jsxs("div",{className:"flex flex-col relative w-full",children:[e.jsxs("div",{className:"relative w-full h-[calc(3rem+130px)] sm:h-[calc(3rem+160px)] md:h-[calc(3rem+200px)] 2xl:h-[calc(3rem+250px)]",children:[!v&&e.jsx("div",{className:"absolute inset-0 z-20",children:e.jsx(o,{})}),e.jsxs("div",{className:c("w-full px-3 py-3 sm:px-4 sm:py-4 md:px-8 md:py-6 flex gap-2 sm:gap-3 md:gap-4 absolute inset-0","bg-gradient-to-b from-background/20 to-background/50","flex-col"),style:{backgroundColor:k},children:[e.jsxs("div",{className:"flex flex-row sm:flex-nowrap items-end sm:items-center w-full gap-3 sm:gap-4 md:gap-6 lg:gap-8",children:[e.jsx("div",{className:c("w-[120px] h-[120px] min-w-[120px] min-h-[120px]","sm:w-[160px] sm:h-[160px] sm:min-w-[160px] sm:min-h-[160px]","md:w-[200px] md:h-[200px] md:min-w-[200px] md:min-h-[200px]","2xl:w-[250px] 2xl:h-[250px] 2xl:min-w-[250px] 2xl:min-h-[250px]","bg-skeleton aspect-square bg-cover bg-center rounded","shadow-header-image overflow-hidden","hover:scale-[1.02] ease-linear duration-100"),children:e.jsx(l.LazyLoadImage,{effect:"opacity",crossOrigin:"anonymous",id:"cover-art-image",src:i(h,p,f),alt:j,className:"aspect-square object-cover w-full h-full cursor-pointer",width:"100%",height:"100%",onLoad:async function(){const e=R();if(!e)return;let s=a(!0);try{s=(await m(e)).hex}catch(t){console.warn("handleLoadImage: unable to get image color. Using a random color.")}P(s),N(!0)},onError:function(){const e=R();e&&(e.crossOrigin=null,N(!0))},onClick:()=>S(!0)},h)}),e.jsxs("div",{className:"flex w-full max-w-[calc(100%-128px)] sm:max-w-[calc(100%-172px)] md:max-w-[calc(100%-216px)] 2xl:max-w-[calc(100%-266px)] flex-col justify-end z-10",children:[e.jsx("p",{className:"text-[10px] sm:text-xs 2xl:text-sm font-medium drop-shadow",children:n}),e.jsx("h1",{className:t("max-w-full scroll-m-20 font-bold tracking-tight antialiased drop-shadow-md break-words","line-clamp-5 sm:line-clamp-2 text-xl leading-none sm:text-[2em] mb-2",H(r)),children:r}),e.jsx(X,{isPlaylist:w,artists:g,subtitle:x,artistId:u,badges:b,className:"hidden sm:flex"})]})]}),e.jsx("div",{className:"sm:hidden bg-transparent",children:e.jsx(X,{isPlaylist:w,artists:g,subtitle:x,artistId:u,badges:b})})]}),v?e.jsx(d,{style:{backgroundColor:k}}):e.jsx(d,{className:"bg-muted-foreground"})]}),e.jsx(y,{open:C,close:S,src:i(h,p,f),alt:j})]},`header-${h}`)}function J({table:s}){const{t:a}=O();return e.jsx("div",{className:"flex items-center justify-end mt-4",children:e.jsxs("div",{className:"flex items-center space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:a("table.pagination.rowsPerPage")}),e.jsxs(x,{value:`${s.getState().pagination.pageSize}`,onValueChange:e=>{s.setPageSize(Number(e))},children:[e.jsx(u,{className:"h-8 w-[70px]",children:e.jsx(g,{placeholder:s.getState().pagination.pageSize})}),e.jsx(h,{side:"top",children:[10,20,30,40,50].map(s=>e.jsx(p,{value:`${s}`,children:s},s))})]})]}),e.jsx("div",{className:"flex items-center justify-center text-sm font-medium",children:a("table.pagination.currentPage",{currentPage:s.getState().pagination.pageIndex+1,totalPages:s.getPageCount()})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(f,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:a("table.pagination.screenReader.firstPage")}),e.jsx($,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:a("table.pagination.screenReader.previousPage")}),e.jsx(q,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:a("table.pagination.screenReader.nextPage")}),e.jsx(V,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:a("table.pagination.screenReader.lastPage")}),e.jsx(B,{className:"h-4 w-4"})]})]})]})})}const ee=s.memo(A),se=s.memo(function({cell:s}){const a=s.column.columnDef;return e.jsx("div",{className:t("p-2 flex flex-row items-center justify-start [&:has([role=checkbox])]:pr-4",a.className),style:a.style,role:"cell",children:S(s.column.columnDef.cell,s.getContext())},s.id)});const ae=s.memo(function({index:a,row:l,contextMenuOptions:n,variant:i,dataType:r,isPrevRowSelected:o,isNextRowSelected:c,...d}){const m=j(),x="classic"===i,u="modern"===i,g=s.useMemo(()=>"song"===r&&l.original.id===m.id,[m.id,r,l.original]);return e.jsx(ee,{options:n,children:e.jsx("div",{...d,role:"row","data-test-id":"table-row","data-state":l.getIsSelected()&&"selected",className:t("group/tablerow w-full flex flex-row transition-colors",u&&l.getIsSelected()&&!o(a)&&"rounded-t-md",u&&l.getIsSelected()&&!c(a)&&"rounded-b-md",u&&!l.getIsSelected()&&"rounded-md","hover:bg-muted data-[state=selected]:bg-primary/75",x&&"border-b",g&&u&&"row-active bg-accent"),children:l.getVisibleCells().map(s=>e.jsx(se,{cell:s},s.id))})})});let te,le=!1;function ne({columns:a,data:l,handlePlaySong:n,columnFilter:i,showPagination:r=!1,showSearch:o=!1,searchColumn:c,noRowsMessage:d="No results.",allowRowSelection:m=!0,showContextMenu:x=!0,showHeader:u=!0,showDiscNumber:g=!1,variant:h="classic",dataType:p="song"}){const{t:j}=O(),v=a.filter(e=>i?.includes(e.id)),[N,y]=s.useState([]),[C,A]=s.useState([]),[$,q]=s.useState({}),[V,B]=s.useState(null),_="classic"===h,H="modern"===h,W=s.useMemo(()=>Object.keys($).map(Number),[$]),Y=s.useCallback(e=>W.includes(e),[W]),Q=s.useCallback(e=>Y(e-1),[Y]),U=s.useCallback(e=>Y(e+1),[Y]),X=k({data:l,columns:i?v:a,getCoreRowModel:F(),getPaginationRowModel:r?I():void 0,onColumnFiltersChange:y,getFilteredRowModel:o?R():void 0,onSortingChange:A,getSortedRowModel:P(),onRowSelectionChange:q,enableSorting:!0,sortingFns:{customSortFn:(e,s,a)=>e.original[a].localeCompare(s.original[a])},meta:{handlePlaySong:n},state:{columnFilters:N,sorting:C,rowSelection:$}}),{rows:Z}=X.getRowModel(),ee=s.useCallback((e=!0)=>{m&&X.toggleAllRowsSelected(e)},[m,X]);T("mod+a",()=>ee(),{preventDefault:!0,enabled:!X.getIsAllRowsSelected()}),T("esc",()=>ee(!1),{preventDefault:!0,enabled:X.getIsAllRowsSelected()||X.getIsSomeRowsSelected()});const se=void 0!==c?X.getColumn(c||"")?.getFilterValue():void 0,ne=s.useCallback(()=>{const e=[],s=new Set;return g?(Z.forEach(({original:a},t)=>{const l=a;"discNumber"in l&&(s.has(l.discNumber)||(s.add(l.discNumber),e.push(t)))}),{uniqueIndices:e,seen:s}):{uniqueIndices:e,seen:s}},[Z,g])(),ie=ne.seen.size<=1,re=ne.uniqueIndices,oe=s.useCallback(s=>{if(x)return"song"===p?X.getIsSomeRowsSelected()||X.getIsAllRowsSelected()?e.jsx(D,{table:X}):e.jsx(L,{variant:"context",index:s.index,song:s.original}):"playlist"===p?e.jsx(z,{variant:"context",playlist:s.original,showPlay:!0}):void 0},[p,x,X]),ce=s.useCallback((e,s)=>{if(!m)return;if(M.isMacOs?e.metaKey:e.ctrlKey)return s.toggleSelected(),void B(s.index);if(e.shiftKey&&null!==V){const e=E(V,s.index);return void X.setRowSelection(e)}X.setRowSelection({[s.index]:!0}),B(s.index)},[m,V,X]),de=s.useCallback(e=>{if(!m)return;const s=W.length>0,a=Y(e.index);s&&!a&&X.resetRowSelection(),e.toggleSelected(!0),B(e.index)},[m,Y,W.length,X]),me=s.useCallback((e,s)=>{e.nativeEvent.button===b.Left&&ce(e,s),e.nativeEvent.button===b.Right&&de(s)},[ce,de]),xe=s.useCallback((e,s)=>{n&&(e.stopPropagation(),n(s))},[n]),ue=s.useCallback((e,s)=>{if(clearTimeout(te),le&&n){const a=e.target,t=a.closest("button"),l=a.closest('[role="button"]');t||l||(e.stopPropagation(),n(s))}},[n]);function ge(){le=!0,te=setTimeout(()=>{le=!1},500)}function he(){le=!1}function pe(){clearTimeout(te),le=!1}return e.jsxs(e.Fragment,{children:[o&&c&&e.jsx("div",{className:"flex items-center mb-4","data-testid":"table-search",children:e.jsxs("div",{className:"w-72 relative",children:[e.jsx(w,{placeholder:j("sidebar.search"),value:se??"",onChange:e=>X.getColumn(c)?.setFilterValue(e.target.value),autoCorrect:"false",autoCapitalize:"false",spellCheck:"false"}),""!==se&&void 0!==se&&e.jsx(f,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 w-6 h-6",onClick:()=>X.getColumn(c)?.setFilterValue(""),children:e.jsx(G,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:t(_&&"rounded-md border"),children:e.jsxs("div",{className:t("relative w-full overflow-hidden rounded-md cursor-default caption-bottom text-sm",_?"bg-background":"bg-transparent"),"data-testid":"data-table",role:"table",children:[u&&e.jsx("div",{children:X.getHeaderGroups().map(s=>e.jsx("div",{className:t("w-full flex flex-row border-b",H&&"mb-2 border-foreground/20"),role:"row",children:s.headers.map(s=>{const a=s.column.columnDef;return e.jsx("div",{className:t("p-2 h-12 flex items-center justify-start align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-4",a.className),style:a.style,role:"columnheader",children:s.isPlaceholder?null:S(s.column.columnDef.header,s.getContext())},s.id)})},s.id))}),e.jsx("div",{className:"[&_div:last-child]:border-0",children:e.jsx("div",{className:"w-full h-full overflow-hidden",children:Z?.length?Z.map((a,l)=>e.jsxs(s.Fragment,{children:[g&&!ie&&re.includes(l)&&e.jsxs("div",{className:t("w-full h-14 flex flex-row items-center transition-colors text-muted-foreground",_&&"border-b"),role:"row",children:[e.jsx("div",{className:"w-12 flex items-center justify-center",children:e.jsx(K,{strokeWidth:1.75})}),e.jsx("span",{className:"font-medium ml-[7px]",children:j("album.table.discNumber",{number:a.original.discNumber})})]}),e.jsx(ae,{index:l,row:a,contextMenuOptions:oe(a),isPrevRowSelected:Q,isNextRowSelected:U,variant:h,dataType:p,onClick:e=>me(e,a),onDoubleClick:e=>xe(e,a),onTouchStart:ge,onTouchMove:he,onTouchEnd:e=>ue(e,a),onTouchCancel:pe,onContextMenu:e=>me(e,a)})]},a.id)):e.jsx("div",{role:"row",children:e.jsx("div",{className:"flex h-24 items-center justify-center p-2",role:"cell",children:d})})})})]})}),r&&e.jsx(J,{table:X})]})}export{ne as D,Z as I};
