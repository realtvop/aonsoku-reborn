import{j as e,r as t}from"./react-BohqOKG4.js";import{f as l,h as o,k as s,g as n,b as a}from"./@tanstack-3eZgfo06.js";import{c as r}from"./clsx-BeLtu-UY.js";import{d as c}from"./lodash-DSAJ3Ow_.js";import{l as i}from"./react-device-detect-CHs-JbVH.js";import{u as d}from"./react-hotkeys-hook-qKPfarcW.js";import{C as u,S as m,e as g,f as h}from"./play-button-BMYlYUiF.js";import{C as f,a$ as x,S as p,s as b}from"./index-Dw_5HS3q.js";const w=t.memo(u),v=t.memo(function({cell:t}){const o=t.column.columnDef;return e.jsx("div",{className:r("p-2 flex flex-row items-center justify-start [&:has([role=checkbox])]:pr-4",o.className),style:o.style,role:"cell",children:l(o.cell,t.getContext())},t.id)});let S,C=!1;const j=t.memo(function({row:l,virtualRow:o,handleClicks:s,handleRowDbClick:n,handleRowTap:a,getContextMenuOptions:c,dataType:i="song",pageType:d="general"}){const u=f(),m=t.useMemo(()=>"song"===i&&l.original.id===u.id,[u.id,i,l.original]),g="queue"===d;return e.jsx(w,{options:c(l),children:e.jsx("div",{role:"row","data-test-id":"table-row","data-row-index":o.index,"data-state":l.getIsSelected()&&"selected",onClick:e=>s(e,l),onDoubleClick:e=>n(e,l),onTouchStart:function(){C=!0,S=setTimeout(()=>{C=!1},500)},onTouchMove:function(){C=!1},onTouchEnd:function(e){if(clearTimeout(S),C){const t=e.target,o=t.closest("button"),s=t.closest('[role="button"]');o||s||a(e,l)}},onTouchCancel:function(){clearTimeout(S),C=!1},onContextMenu:e=>s(e,l),className:r("group/tablerow w-[calc(100%-10px)] flex flex-row transition-colors","data-[state=selected]:bg-primary/75 hover:bg-muted",g&&"rounded-md",m&&"row-active bg-accent"),style:{height:`${o.size}px`,position:"absolute",top:o.start},children:l.getVisibleCells().map(t=>e.jsx(v,{cell:t},t.id))})})}),y=t.memo(function({header:t}){const o=t.column.columnDef;return e.jsx("div",{className:r("p-2 h-10 flex items-center justify-start align-middle font-medium","text-muted-foreground","[&:has([role=checkbox])]:pr-4",o.className),style:o.style,role:"columnheader",children:t.isPlaceholder?null:l(o.header,t.getContext())})});function k({columns:l,data:u,handlePlaySong:f,columnFilter:w,noRowsMessage:v="No results.",showHeader:S=!0,allowRowSelection:C=!0,showContextMenu:k=!0,dataType:R="song",pageType:T="general",fetchNextPage:N,hasNextPage:E,scrollToIndex:M=!1,currentSongIndex:I}){const D=l.filter(e=>w?.includes(e.id)),[P,F]=t.useState([]),[O,A]=t.useState([]),[H,q]=t.useState({}),[z,K]=t.useState(null),L=t.useMemo(()=>Object.keys(H).map(Number),[H]),V=t.useCallback(e=>L.includes(e),[L]),$=t.useMemo(()=>({data:u,columns:w?D:l,getCoreRowModel:s(),onColumnFiltersChange:F,onSortingChange:A,getSortedRowModel:o(),onRowSelectionChange:q,enableSorting:!1,sortingFns:{customSortFn:(e,t,l)=>e.original[l].localeCompare(t.original[l])},meta:{handlePlaySong:f},state:{columnFilters:P,sorting:O,rowSelection:H}}),[u,l,D,w,f,P,O,H]),G=n($),{rows:X}=G.getRowModel(),_=t.useRef(null),B=t.useCallback(()=>56,[]),J=a({count:X.length,getScrollElement:()=>_.current?_.current.querySelector(b):null,estimateSize:B,overscan:5}),Q=t.useCallback((e=!0)=>{C&&G.toggleAllRowsSelected(e)},[C,G]);d("mod+a",()=>Q(),{preventDefault:!0,enabled:!G.getIsAllRowsSelected()}),d("esc",()=>Q(!1),{preventDefault:!0,enabled:G.getIsAllRowsSelected()||G.getIsSomeRowsSelected()});const U=t.useCallback(t=>{if(k)return"song"===R?G.getIsSomeRowsSelected()||G.getIsAllRowsSelected()?e.jsx(m,{table:G}):e.jsx(g,{variant:"context",index:t.index,song:t.original}):void 0},[R,k,G]),W=t.useCallback((e,t)=>{if(!C)return;if(i.isMacOs?e.metaKey:e.ctrlKey)return t.toggleSelected(),void K(t.index);if(e.shiftKey&&null!==z){const e=h(z,t.index);return void G.setRowSelection(e)}G.setRowSelection({[t.index]:!0}),K(t.index)},[C,z,G]),Y=t.useCallback(e=>{if(!C)return;const t=L.length>0,l=V(e.index);t&&!l&&G.resetRowSelection(),e.toggleSelected(!0),K(e.index)},[C,V,L.length,G]),Z=t.useCallback((e,t)=>{e.nativeEvent.button===x.Left&&W(e,t),e.nativeEvent.button===x.Right&&Y(t)},[W,Y]),ee=t.useCallback((e,t)=>{f&&(e.stopPropagation(),f(t))},[f]),te=t.useCallback((e,t)=>{if(!f)return;const l=e.target,o=l.closest("button"),s=l.closest('[role="button"]');o||s||(e.stopPropagation(),f(t))},[f]),le=t.useCallback(()=>{if(!J.scrollElement||!E||!N)return;const{scrollTop:e,clientHeight:t,scrollHeight:l}=J.scrollElement;e+t>=l-l/8&&N()},[N,E,J.scrollElement]),oe=t.useMemo(()=>c(le,200),[le]);return t.useEffect(()=>{if(!J.scrollElement)return;const e=J.scrollElement;return e.addEventListener("scroll",oe),()=>{e.removeEventListener("scroll",oe)}},[J.scrollElement,oe]),t.useEffect(()=>{M&&I&&J.scrollToIndex(I,{align:"start"})},[I,M,J]),e.jsx("div",{className:"h-full",children:e.jsxs("div",{className:"relative w-full h-full overflow-hidden cursor-default caption-bottom text-sm bg-transparent","data-testid":"data-table",role:"table",children:[e.jsx("div",{className:r(!S&&"hidden"),children:G.getHeaderGroups().map(t=>e.jsx("div",{className:"w-full flex flex-row border-b pr-[10px] bg-muted",role:"row",children:t.headers.map(t=>e.jsx(y,{header:t},t.id))},t.id))}),e.jsx(p,{ref:_,type:"always",className:r("[&_div:last-child]:border-0 overflow-auto",S?"h-[calc(100%-41px)]":"h-full"),thumbClassName:r("queue"===T&&"secondary-thumb-bar"),children:e.jsx("div",{className:"w-full relative",style:{height:`${J.getTotalSize()}px`},children:J.getVirtualItems().length?J.getVirtualItems().map(t=>{const l=X[t.index];return e.jsx(j,{row:l,virtualRow:t,handleClicks:Z,handleRowDbClick:ee,handleRowTap:te,getContextMenuOptions:U,dataType:R,pageType:T},l.id)}):e.jsx("div",{role:"row",children:e.jsx("div",{className:"flex h-24 items-center justify-center p-2",role:"cell",children:v})})})})]})})}export{k as D};
